function insertCss(e,t){var a=document.head,i=document.createElement("link");0!=e.theme&&(i.grs=t,i.type="text/css",i.rel="stylesheet",i.href=grsPluginUrl+"/css/grsTemplate"+e.theme+".css?lastmodified="+e.themeLastModDate,a.appendChild(i),i.onload=function(){var e=document.querySelector("#grsGal"+this.grs+" > div"),t=angular.element(e).scope();t.params.cssReady=!0,t.$$phase||t.$apply()})}var html=document.getElementsByTagName("html")[0],grsApp=angular.module("grsApp",["ngTouch"]);angular.element(document).ready(function(){var e=document.createElement("div"),t=document.createElement("grs-popup");e.setAttribute("ng-controller","grsPopupC"),t.setAttribute("resize","resize"),e.appendChild(t),document.body.appendChild(e),angular.bootstrap(html,["grsApp"])}),grsApp.directive("imageOnload",["GrsService",function(e){return{restrict:"A",link:function(e,t,a){t.bind("load",function(){e.$apply(a.imageOnload)})}}}]),grsApp.directive("backImg",["GrsService",function(e){return{restrict:"A",scope:!0,link:function(t,a,i){var n=i.backImg;e.log(n),n=n.replace(/'/g,"\\'"),a.css({"background-image":"url('"+n+"')"})}}}]),grsApp.directive("ifrSrc",["GrsService",function(e){return{restrict:"A",scope:!0,link:function(e,t,a){var i=a.ifrSrc;i=i.replace(/'/g,"\\'"),t.attr("src",i)}}}]),grsApp.directive("vgSrc",["GrsService",function(e){return{restrict:"A",scope:!0,link:function(e,t,a){var i=a.vgSrc;i=i.replace(/'/g,"\\'"),t.attr("src",i)}}}]),grsApp.directive("resize",["$window","GrsService",function(e,t){return{link:function(t){function a(e){t.$broadcast("resize::resize")}angular.element(e).on("resize",a),t.$on("$destroy",function(){angular.element(e).off("resize",a)})}}}]),grsApp.directive("scroll",["$window","GrsService",function(e,t){return{link:function(t){function a(e){t.$broadcast("scroll::scroll",5022)}angular.element(e).on("scroll",a),t.$on("$destroy",function(){angular.element(e).off("scroll",a)})}}}]),grsApp.directive("postComm",["GrsService",function(e){return function(e,t,a){t.bind("keydown keypress",function(t){13===t.which&&t.shiftKey||13===t.which&&(t.preventDefault(),e.$apply(function(){e.postIc()}))})}}]),grsApp.service("GrsService",["$log","$window","$sce",function(e,t,a){this.mode="pro",this.wpUploaderUrl=grsWpUploaderUrl,this.uploaderUrl=grsUploaderUrl,this.shareUrl=grsShareUrl,this.pluginUrl=grsPluginUrl,this.pluginVer=grsPluginVer,this.config=grsConfig,this.imagesDir=this.pluginUrl+"/images/",this.settings={},this.settingsReady=!1,this.effectsJsonUrl=a.trustAsResourceUrl(this.pluginUrl+"/frontend/views/grsEffects.json?ver="+this.pluginVer),this.getViewsTemplateUrl=function(e){return a.trustAsResourceUrl(this.pluginUrl+"/frontend/views/"+e+".html?ver="+this.pluginVer)},this.popup={grs:0,show:!1,shatts:{},theme:{},first:!0,items:[],pI:[],cP:0,pC:0,tC:0,lC:0,index:0},this.setPopObj=function(e){if(this.popup.grs=e.grs,this.popup.gallId=e.gallId,this.popup.shatts=e.shatts,this.popup.theme=e.theme,this.popup.orderby=e.orderby,this.popup.ordering=e.ordering,this.popup.items=e.items,this.popup.cP=e.cP,this.popup.pC=e.pC,this.popup.tC=e.tC,this.popup.lC=e.lC,this.popup.index=e.index,0!=e.pC)for(var t=0;t<e.pC;t++)void 0!==e.pI[t]&&(this.popup.pI[t]=e.pI[t]);else this.popup.pI=[];this.log(e),this.popup.show=angular.copy(e.show)},this.setSettings=function(e){this.settings.collapseNavClicks=parseInt(e.collapseNavClicks),this.settings.fmImMoveCount=parseInt(e.fmImMoveCount),this.settings.filmImMoveCount=parseInt(e.filmImMoveCount),this.settings.hideNavButton=parseInt(e.hideNavButton),this.settings.closeLbOnSide=parseInt(e.closeLbOnSide),this.settings.openCommTrig=parseInt(e.openCommTrig),this.settings.showTitleDescTrig=parseInt(e.showTitleDescTrig),this.settings.default=parseInt(e.default),this.settings.clicksCount=parseInt(e.clicksCount)},this.grsShTC=function(e,t){return"always"===e||"onhover"===e&&"mask"!==t},this.grsShMC=function(e,t){return"mask"===t&&"onhover"===e},this.grsOnhv=function(e){return"onhover"===e},this.log=function(t){"dev"===this.mode&&e.log(t)},this.getImageVer=function(e,t,a){var i="thumbnail"===a?2:1;return e=parseInt(e),t=parseInt(t),e<=400/i&&t<=400/i?"thumbnail/":e<=800/i&&t<=800/i?"medium/":e<=1500/i&&t<=1500/i?"large/":e<=2e3/i&&t<=2e3/i?"extralarge/":""},this.getImageSource=function(e,t){return this["itemSource_"+e.embed](e,t)},this.itemSource_=function(e,t){var a=this.getImageVer(e.thumbWidth,e.thumbHeight,t);return this.uploaderUrl+e.path+a+e.name+e.type},this.itemSource_instagram=function(e,t){var a=parseInt(e.thumbWidth),i=parseInt(e.thumbHeight),n=e.type,o="thumbnail"===t?2:1;return"video"===n||a<=300/o&&i<=300/o?e.thumb_url:e.path},this.itemSource_youtube=function(e){return e.thumb_url},this.itemSource_vimeo=function(e){return e.thumb_url},this.itemSource_flickr=function(e,t){var a=parseInt(e.thumbWidth),i=parseInt(e.thumbHeight),n="thumbnail"===t?2:1;return a<=400/n&&i<=400/n?e.thumb_url:e.path},this.itemSource_wp=function(e,t){var a=this.getWPImageSizes(e);return this.wpUploaderUrl+e.path+e.name+this.getImageVerWp(parseInt(e.thumbWidth),parseInt(e.thumbHeight),a,t)+e.type},this.getWPImageSizes=function(e){var t=parseInt(e.width),a=parseInt(e.height),i=e.wp_sizes;if(null===i)return{medium:t>300||a>300?this.getRightSizeUrlForWp(300,t,a):"",large:t>1024||a>1024?this.getRightSizeUrlForWp(1024,t,a):"",full:""};e.wp_sizes="object"!=typeof i?JSON.parse(i):i;var n=void 0!==(i=e.wp_sizes).large?"-"+i.large.width+"x"+i.large.height:"";return{medium:void 0!==i.medium?"-"+i.medium.width+"x"+i.medium.height:n,large:n,full:""}},this.getImageVerWp=function(e,t,a,i){var n="thumbnail"===i?2:1;return e<=400/n&&t<=400/n?a.medium:e<=800/n&&t<=800/n?a.large:a.full},this.getLightboxWPimageSize=function(e,t,a,i){var n=this.getWPImageSizes(e);return this.getImageVerWp(parseInt(t),parseInt(a),n,i)},this.getRightSizeUrlForWp=function(e,t,a){return t>a?"-"+e+"x"+Math.round(e*a/t):"-"+Math.round(e*t/a)+"x"+e},this.shVIc=function(e){var t=e.type;return"video"===t||"link"===t},this.link=function(e,a){t.open(this["link_"+e.embed](e),a)},this.link_=function(e){return""===e.link?this.uploaderUrl+e.path+e.name+e.type:e.link},this.link_wp=function(e){return""===e.link?this.wpUploaderUrl+e.path+e.name+e.type:e.link},this.link_youtube=function(e){return""===e.link?e.path:e.link},this.link_instagram=function(e){return this.link_youtube(e)},this.link_flickr=function(e){return this.link_youtube(e)},this.link_vimeo=function(e){return this.link_youtube(e)},this.toUpperCaseFl=function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},this.getWidthHeightForFmResize=function(e,t,a){var i={};return t>a?(i.height=Math.round(e/Math.round(t/a)),i.width=e):(i.width=Math.round(e/Math.round(a/t)),i.height=e),i}}]),grsApp.controller("grsPopupC",["$scope","$filter","$log","GrsService","GrsFactory",function(e,t,a,i,n){n.getSettings().then(function(e){angular.isUndefined(e.data.success)?i.log("Error , try to get settings."):(i.setSettings(e.data.success),i.log("gagao"),i.settingsReady=!0)},function(e){i.log(e)})}]),grsApp.directive("grsPopup",["$filter","GrsFactory","GrsService","$window","$timeout","$location",function(e,t,a,i,n,o){return{restrict:"E",transclude:!0,scope:!1,templateUrl:a.getViewsTemplateUrl("grsPopup"),link:function(e,r,s){if(e.options={show:a.popup.show},e.options.enterPopup=function(){return e.options.show&&e.options.effectsLoaded},e.options.showPopup=function(){return e.view.ready=e.options.commContloaded&&e.options.filmContLoaded,e.view.ready},e.params={grs:0,gallId:a.popup.gallId,shatts:a.popup.shatts,theme:a.popup.theme},e.psImg={},a.config.effects)t.getEffects().then(function(t){e.grsEffects=t.data,e.options.show&&e.setEffect(e.params.shatts.lightboxeffect),e.options.effectsLoaded=!0,e.$$phase||e.$apply()},function(e){a.log(e)});else{var g={};g.noEffect={},g.noEffect.effects={},g.noEffect.effects.no={},g.noEffect.doEffect="grsNoEffect",g.noCutting={},g.noCutting.effects={},g.noCutting.effects.fade={},g.noCutting.effects.fade.in="grsFadeIn grsAnDur inAnimationEnd",g.noCutting.effects.fade.out="grsFadeOut grsAnDur outAnimationEnd",g.noCutting.doEffect="grsNoCuting",e.grsEffects=g,e.options.effectsLoaded=!0}e.view={cImIn:0,effect:{},mainAnimationEnd:!0,cImInG:-1,grsCC:[],isFS:!1,shInf:!0,enAp:!1,isFSSmart:!1,active:"",actImg:"",captcha:"",comments:{},isOCC:!0,contButtOp:!0,filmView:a.getViewsTemplateUrl("grsFilmstrip"),commView:a.getViewsTemplateUrl("grsComments")},e.effectsTiming={msForEff:["550","570","590","520","550","870","890","810","830","850","1070","1090","1010","1030","1050","1270","1290","1210","1230","1250","1470","1490","1410","1430","1550","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570"],msForEffHor:["500","600","700","800","900","1000","1100","1200","1300","1400","1500","1600"]},e.browser={pfx:["webkit","moz","ms","o",""],name:""},e.checkBrowser=function(){var t=navigator.userAgent;if(-1!=t.indexOf("Firefox"))e.browser.name="Firefox";else if(-1!=t.indexOf("OPR"))e.browser.name="Opera";else if(-1!=t.indexOf("Edge"))e.browser.name="Edge";else if(-1!=t.indexOf("Safari")){var a=/Google Inc/.test(navigator.vendor),i=/Apple Computer/.test(navigator.vendor);a?e.browser.name="Chrome":i&&(e.browser.name="Safari")}else e.browser.name="Explorer"},e.checkBrowser(),e.items=[],e.$watch(function(){return a.popup.show},function(t,i){e.options.show=t,e.params.grs=a.popup.grs,e.params.gallId=a.popup.gallId,e.params.shatts=a.popup.shatts,e.params.theme=a.popup.theme,e.params.orderby=a.popup.orderby,e.params.ordering=a.popup.ordering,e.items=a.popup.items,e.view.pI=a.popup.pI,e.view.cP=a.popup.cP,e.view.pC=a.popup.pC,e.view.tC=a.popup.tC,e.view.lC=a.popup.lC,e.view.cImIn=a.popup.index,e.view.noEffect="no"===e.params.shatts.lightboxeffect,e.view.mainAnimationEnd=!0,e.view.loading=!1,e.view.cloading=!1,e.view.outAnimationEnd=!0,e.view.inAnimationEnd=!0,e.view.active="",e.view.actImg="",e.view.grsCC=[],e.view.comments={},e.view.isOCC="1"===e.params.shatts.lightboxcomment&&a.settings.openCommTrig,e.view.emptyName=!1,e.view.invalidMail=!1,e.view.emptyComment=!1,e.view.emptyCaptcha=!1,e.view.contButtOp=!0,e.view.isFSSmart=!1,e.view.actImgId=0,e.view.isFS=!1,e.view.ready=!1,e.view.shInf=a.settings.showTitleDescTrig,e.view.enAp=!1,e.view.apInt=1e3*parseInt(e.params.shatts.lightboxapin),e.options.commContloaded=!(a.config.comments&&"1"===e.params.shatts.lightboxcomment),e.options.filmContLoaded=!(a.config.filmstrip&&"1"===e.params.shatts.lightboxfilmstrip);var o=angular.isString(e.view.cImIn)&&-1!==e.view.cImIn.indexOf("hash-")?e.view.cImIn:a.popup.cP*e.params.shatts.imagesperpage+e.view.cImIn;if(angular.isUndefined(e.view.cachCmmAct)||delete e.view.cachCmmAct,!e.options.show)return delete e.view.firstIn,e.view.cImInG=-1,void(e.view.setAutoplay&&n.cancel(e.view.setAutoplay));e.setViewParamsByRes(),e.setEffect(e.params.shatts.lightboxeffect),e.setItem(o),e.getItems(o)},!0),e.$watch("view.ready",function(){e.view.ready&&e.options.show&&jQuery("html, body").addClass("grsPopupParents")},!0),e.getItems=function(i){var n=[];if("numbers"===e.params.shatts.pagination){for(var o=0;o<e.view.pC;o++)if(angular.isUndefined(e.view.pI[o])){r={from:o,count:e.params.shatts.imagesperpage};n.push(r)}}else if(e.view.pI[0].length!=e.view.tC){var r={from:e.view.lC,count:e.params.shatts.imagesperpage*(e.view.pC-e.view.lC)};n.push(r)}if(n.length>0)t.getPopupData(e.params.gallId,n,e.params.shatts.imagesperpage,e.params.orderby,e.params.ordering).then(function(t){if(void 0!==t.data.success){var o=t.data.success;if("numbers"==e.params.shatts.pagination)for(var r=0;r<n.length;r++){e.view.pI[n[r].from]=[];for(var s=0;s<n[r].count;s++)void 0!==o[n[r].count*r+s]&&(e.view.pI[n[r].from][s]=o[n[r].count*r+s])}else e.view.pI[0]=e.view.pI[0].concat(o);for(var g=0;g<e.view.pI.length;g++)e.items=e.items.concat(e.view.pI[g])}else a.log("Error , something went wrong.");e.checkForgrsHash()||e.setFW(i)},function(e){a.log(e)});else{a.log("Images already loaded");for(var s=0;s<e.view.pI.length;s++)e.items=e.items.concat(e.view.pI[s]);e.checkForgrsHash()||e.setFW(i)}},e.checkForgrsHash=function(){if(angular.isString(e.view.cImInG)&&-1!=e.view.cImInG.indexOf("hash-")){for(var t=e.view.cImInG.split("hash-")[1],i=!1,n=-1,o=0;o<e.items.length;o++)if(e.items[o].id==t){n=o,i=!0;break}return i?(e.setItem(n,!0),e.setFW(n)):(e.grsCp(),a.log("chkar")),!0}return!1},e.setViewParamsByRes=function(){e.$broadcast("resize::resize")},e.setFW=function(t){e.view.fcw=e.items.length*(e.view.ftw+e.view.ftm+2*(e.view.ftp+e.view.ftbw))+e.view.ftm,e.moveFC("fromImgNav",t)},e.shFilmsVtop=function(){return!("1"!==e.params.shatts.lightboxfilmstrip||!a.config.filmstrip)&&"top"==e.params.theme.filmstripPos},e.shFilmsVbot=function(){return!("1"!==e.params.shatts.lightboxfilmstrip||!a.config.filmstrip)&&"bottom"==e.params.theme.filmstripPos},e.shCbutts=function(){return"1"===e.params.shatts.lightboxcontbutts},e.contButtPos=function(){return e.sisVideo()||e.fisVideo()||e.sisLink()||e.fisLink()?"refactorContent":""},e.grsCheckLNavVis=function(){return 0===e.view.cImInG&&a.settings.hideNavButton?"grsHide":""},e.grsCheckRNavVis=function(){return e.view.cImInG===e.items.length-1&&a.settings.hideNavButton?"grsHide":""},e.shCommCont=function(){return"1"===e.params.shatts.lightboxcomment&&a.config.comments},e.shCommContLoaded=function(){e.options.commContloaded=!0,e.$$phase||e.$apply()},e.shFilmContLoaded=function(){e.options.filmContLoaded=!0,e.$$phase||e.$apply()},e.chSwp=function(){return"1"===e.params.shatts.lightboxswipe?"grsPoin":""},e.fisImage=function(){return"video"!==e.img.type&&"link"!==e.img.type},e.sisImage=function(){return"video"!==e.psImg.type&&"link"!==e.psImg.type},e.fisVideo=function(){return"video"===e.img.type&&"first"===e.view.active},e.sisVideo=function(){return"video"===e.psImg.type&&"second"===e.view.active},e.fisLink=function(){return"link"===e.img.type&&"first"===e.view.active},e.sisLink=function(){return"link"===e.psImg.type&&"second"===e.view.active},e.fImSrc=function(){return e.getLightboxImageSource(e.img,e.view.icw,e.view.ich,"main")},e.sImSrc=function(){return e.getLightboxImageSource(e.psImg,e.view.icw,e.view.ich,"main")},e.setItem=function(t,a){if(e.view.cImInG=t,!angular.isString(e.view.cImInG)||-1==e.view.cImInG.indexOf("hash-")){e.img=void 0===a?e.view.pI[e.view.cP][e.view.cImIn]:e.items[e.view.cImInG],e.view.cImId=e.img.id,e.setLh(e.img.id),e.fillShU(e.img),e.reloadCap();var i=-1!=e.img.type.indexOf(".")?"image":e.img.type;e["setItem_"+i]()}},e.getLightboxImageSource=function(e,t,i,n){var o="main"!==n?"thumb_url":"path";return""===e.embed?a.uploaderUrl+e.path+a.getImageVer(t,i,n)+e.name+e.type:"wp"===e.embed?a.wpUploaderUrl+e.path+e.name+a.getLightboxWPimageSize(e,t,i,n)+e.type:e[o]},e.setItem_image=function(){var t=new Image,i=e.img,n=e.view;t.src=e.getLightboxImageSource(i,n.icw,n.ich,"main"),t.cImInG=n.cImInG,t.cImId=i.id,t.complete||4===t.readyState?e.setSomeViewParams(t.cImId):(n.loading=!0,t.onload=function(){if(this.cImInG==n.cImInG){var t=this.cImId;e.setSomeViewParams(t)}else a.log("not same for first ---------- ");a.log("first change loading end ---------- "),e.$apply()})},e.setItem_video=function(){e.setSomeViewParams(e.img.id)},e.setItem_link=function(){e.setItem_video()},e.setSomeViewParams=function(t){var a=e.view;a.loading=!1,a.firstIn=!0,a.active="first",a.actImg="first",a.mainAnimationEnd=!1,a.inAnimationEnd=!1,a.outAnimationEnd=!1,a.actImgId=t,e.fillICC(t)},e.setData=function(t,i,n){var o,r={},s=e.items.length,g=e.view.grsCC,c=g.length-1,l=c>-1;if(angular.isString(e.view.cImInG)&&-1!=e.view.cImInG.indexOf("hash-"))a.log("Hash not changed.");else{if("previous"==t?o=l&&!e.view.loading?g[c]>0?g[c]-1:s-1:e.view.cImInG>0?e.view.cImInG-1:s-1:"next"==t?o=l&&!e.view.loading?g[c]<s-1?g[c]+1:0:e.view.cImInG<s-1?e.view.cImInG+1:0:"other"==t?o=void 0!==i?i:0:a.log("Unknown change event"),r.imgData=e.items[o],r.cImInG=o,void 0!==r.imgData)return e.view.mainAnimationEnd||e.view.noEffect?void(o!=e.view.cImInG?e.grsChangeItem(r):a.log("Same index ------ ")):(a.log("Animation in progress ------ "),void(a.settings.collapseNavClicks&&g.length<a.settings.clicksCount?(g.push(r.cImInG),a.log(g)):a.log("Stack is full ------ ")));a.log("Images is not loaded")}},e.grsLeft=function(t){void 0!==t&&t.preventDefault();var a=e.view;a.enAp&&a.setAutoplay&&n.cancel(a.setAutoplay),e.setData("previous")},e.swipeLeft=function(t){"1"==e.params.shatts.lightboxswipe&&e.grsLeft(t)},e.grsRight=function(t){var a=e.view;"boolean"!=typeof t&&a.enAp&&a.setAutoplay&&n.cancel(a.setAutoplay),void 0!==t&&"boolean"!=typeof t&&t.preventDefault(),e.setData("next")},e.swipeRight=function(t){"1"==e.params.shatts.lightboxswipe&&e.grsRight(t)},e.selectImg=function(t,a){var i=e.view;i.enAp&&i.setAutoplay&&n.cancel(i.setAutoplay),e.setData("other",t,a)},e.grsChangeItem=function(t){var a=-1!=t.imgData.type.indexOf(".")?"image":t.imgData.type;e["grsChange_"+a](t)},e.grsChange_image=function(t){var i=t.imgData,n=e.view,o=e.items[n.cImInG].id,r=new Image;if(r.src=e.getLightboxImageSource(i,n.icw,n.ich,"main"),r.img=i,r.cImInG=t.cImInG,r.cImId=i.id,n.cImInG=t.cImInG,n.cImId=i.id,e.grsDoAction(i,o),!r.complete&&4!==r.readyState)return n.grsCC=[],n.loading=!0,void(r.onload=function(){if(this.cImInG==n.cImInG)if(void 0===n.firstIn){a.log("firstIn is set after load---------- "),e.img=e.items[this.cImInG],e.psImg=e.img;var t=this.cImId;e.setSomeViewParams(t)}else{if(n.loading=!1,n.actImgId==this.cImId)return void a.log("same id , so not do effect from loaded");a.log("objImg.loaded ---------- ");var i=this;e.setSomeViewParamsForChange(i.img)}else a.log("Not same <---------- ");a.log("Change loading end <---------- "),e.$apply()});if(a.log("objImg.complete ---------- "),void 0===n.firstIn)a.log("firstIn is set ---------- "),e.img=e.items[r.cImInG],e.psImg=e.img,e.setSomeViewParams(r.cImId);else{if(n.loading=!1,n.actImgId==n.cImId)return void a.log("same id , so not do effect");e.setSomeViewParamsForChange(i)}},e.setSomeViewParamsForChange=function(t){var i=e.view,n=e.params.shatts.lightboxeffect,o="no"==n?"no":"fade",r="video"!=t.type&&"link"!=t.type&&"video"!=e.img.type&&"link"!=e.img.type&&"video"!=e.psImg.type&&"link"!=e.psImg.type?n:o;a.log("hmikva typ@ -- "+t.type),i.mainAnimationEnd=!1,i.inAnimationEnd=!1,i.outAnimationEnd=!1,e.setEffect(r),e.grsDoEffect(t),e.fillICC(t.id)},e.grsChange_video=function(t){var i=t.imgData,n=e.view,o=e.items[n.cImInG].id;if(n.cImInG=t.cImInG,n.cImId=i.id,e.grsDoAction(i,o),void 0===n.firstIn)a.log("firstIn is set ---------- "),e.img=e.items[n.cImInG],e.psImg=e.img,e.setSomeViewParams(n.cImId);else{if(n.loading=!1,n.actImgId==n.cImId)return void a.log("same id , so not do effect");e.setSomeViewParamsForChange(i)}},e.grsChange_link=function(t){e.grsChange_video(t)},e.grsDoAction=function(t,a){e.moveFC("fromImgNav",e.view.cImInG),e.changeLh(a,t.id),e.fillShU(t)},e.grsDoEffect=function(t){e.view.actImgId=t.id,e[e.view.effect.func](e.view.effect.obj,t)},e.fillShU=function(t){var i,n=e.params.grs;i=""===t.embed?a.uploaderUrl+t.path+"medium/"+t.name+t.type:"wp"===t.embed?a.wpUploaderUrl+t.path+t.name+a.getLightboxWPimageSize(t,1e3,1e3)+t.type:t.thumb_url,e.view.grsFacebook="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(a.shareUrl+"&socialNetwork=facebook&imageId="+t.id+"&grs="+n+"&curUrl="+encodeURIComponent(o.absUrl())),e.view.grsTwitter="https://twitter.com/intent/tweet?url="+encodeURIComponent(a.shareUrl+"&socialNetwork=twitter&imageId="+t.id+"&grs="+n+"&curUrl="+encodeURIComponent(o.absUrl()))+"&text="+t.title,e.view.grsGooglePlus="https://plus.google.com/share?url="+encodeURIComponent(a.shareUrl+"&socialNetwork=googlePlus&imageId="+t.id+"&grs="+n+"&curUrl="+encodeURIComponent(o.absUrl())),e.view.grsPinterest="https://pinterest.com/pin/create/button/?url="+encodeURIComponent(a.shareUrl+"&socialNetwork=pinterest&imageId="+t.id+"&grs="+n+"&curUrl="+encodeURIComponent(o.absUrl()))+"&media="+encodeURIComponent(i)+"&description="+t.title,e.view.grsTumblr="https://www.tumblr.com/widgets/share/tool?canonicalUrl="+encodeURIComponent(a.shareUrl+"&socialNetwork=tumblr&imageId="+t.id+"&grs="+n+"&curUrl="+encodeURIComponent(o.absUrl())),e.view.grsLinkedIn="https://www.linkedin.com/shareArticle?url="+encodeURIComponent(a.shareUrl+"&socialNetwork=linkedin&imageId="+t.id+"&grs="+n+"&curUrl="+encodeURIComponent(o.absUrl())),e.view.grsReddit="https://reddit.com/submit?url="+encodeURIComponent(a.shareUrl+"&socialNetwork=reddit&imageId="+t.id+"&grs="+n+"&curUrl="+encodeURIComponent(o.absUrl()))+"&title="+t.title},e.setLh=function(e){var t=o.path()+"/id/"+e;o.path(t).replace()},e.changeLh=function(e,t){var a=o.path().replace("/id/"+e,"/id/"+t);o.path(a).replace()},e.clearLh=function(){var t=o.path(),a=e.view.cImId,i=t.replace("/id/"+a,"");o.path(i).replace()},e.fillICC=function(i){var n=e.view.cImInG;-1==Object.keys(e.view.comments).indexOf(n.toString())&&(e.view.comments[n]=[],e.view.cloading=!0,t.getImgComm(i,e.params.gallId).then(function(t){e.view.cloading=!1,void 0!==t.data.success&&(e.view.comments[n]=t.data.success)},function(e){a.log(e)}))},e.postIc=function(){var i=void 0!==e.view.grsCommName?e.view.grsCommName:"",n=void 0!==e.view.grsCapCode?e.view.grsCapCode:"",o=void 0!==e.view.grsCommEmail?e.view.grsCommEmail:"",r=void 0!==e.view.grsCommText?e.view.grsCommText:"",s=e.view.cImId,g=e.params.gallId,c=e.view.cImInG;return a.log("gallid"+g),""===i?(e.view.emptyName=!0,void a.log("Name empty")):e.validateEmail(o)?""==r?(e.view.emptyComment=!0,void a.log("Comment empty")):""==n?(e.view.emptyCaptcha=!0,void a.log("Captcha empty")):void(e.view.cloading||(e.view.cloading=!0,t.postIc(i,n,o,r,s,g).then(function(t){if(e.view.cloading=!1,void 0!==t.data.success){var n={id:t.data.success.insert_id,imgId:s,name:i,galId:g,email:o,comment:r,createDate:t.data.success.createDate};e.view.comments[c].push(n),e.view.grsCapCode="",e.view.grsCommText="",e.reloadCap(),e.view.emptyName=!1,e.view.emptyComment=!1,e.view.emptyCaptcha=!1,e.view.invalidMail=!1}else{if(void 0!==t.data.error)return e.reloadCap(),e.view.grsCapCode="",e.view.emptyCaptcha=!1,void(e.view.emptyCaptcha=!0);a.log("Eror code : "+t.data.error)}},function(e){a.log(e)}))):(e.view.invalidMail=!0,void a.log("Email validation"))},e.validateEmail=function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},e.getFilmImageSrc=function(t){var a=e.items[t],i=e.params.theme;return e.getLightboxImageSource(a,parseInt(i.filmThumbWidth),parseInt(i.filmstripSize),"thumbnail")},e.reloadCap=function(){e.view.cloading||(e.view.cloading=!0,t.reloadCap().then(function(t){e.view.cloading=!1,void 0!==t.data.success&&(e.view.captcha=t.data.success)},function(e){a.log(e)}))},e.moveFC=function(t,i){function n(e,t){var a=t?-1*parseInt(e/h):parseInt((p-(u+-1*e))/h);if(a>0){var i=v>a?a:v;t?e+=i*h:e-=i*h}return e}var o,r,s,g,c=e.view.flp,l=e.items.length,m=!1,p=e.view.fcw,u=e.view.icw,h=e.view.ftw+e.view.ftm+2*(e.view.ftp+e.view.ftbw),d=a.settings.fmImMoveCount,f=Math.floor(Math.floor(u/h)/2),v=f<d?0===f?1:f:d;if("left"===t){if(u+-1*c>=p)return;o=n(c-(p-(u+-1*c))%h,!1)}else if("right"===t){if(0===c)return;o=n(c+-1*c%h,!0)}else"fromImgNav"===t&&(g=(l-i-1)*h,r=p-(u+-1*c),(s=i*h*-1)>=c||-1*s- -1*c<h?o=n(s,!0):g<=r||g-r<h?o=n(-1*(o=p-g-u),!1):m=!0);m||(e.view.flp=o,e.$$phase||e.$apply())},e.hideNav=function(){return e.view.icw+-1*e.view.flp>=e.view.fcw},e.grsSInf=function(t){e.view.shInf=!e.view.shInf},e.grsGetInfT=function(){return"first"==e.view.active?e.img.title:e.psImg.title},e.grsGetInfD=function(){return"first"==e.view.active?e.img.description:e.psImg.description},e.grsEnAp=function(){e.view.enAp=!e.view.enAp,e.view.enAp?e.doAutoPlay():e.view.setAutoplay&&n.cancel(e.view.setAutoplay)},e.grsPopupEnAp=function(){return e.view.enAp?"fa-"+e.params.theme.pause:"fa-"+e.params.theme.play},e.doAutoPlay=function(){var t=e.view;t.setAutoplay&&n.cancel(t.setAutoplay),t.setAutoplay=n(function(t){e.grsRight(!0)},t.apInt)},e.grsSFM=function(t){var i=document.getElementById("grsPopup");e.view.isFS?(document.fullscreenEnabled?(document.exitFullscreen(),e.view.isFS=!1):document.webkitFullscreenEnabled?(document.webkitExitFullscreen(),e.view.isFS=!1):document.mozFullScreenEnabled?(document.mozCancelFullScreen(),e.view.isFS=!1):document.msFullscreenEnabled&&(document.msExitFullscreen(),e.view.isFS=!1),e.view.isFS||(e.view.isFSSmart=!1),e.$broadcast("resize::resize")):(document.fullscreenEnabled?(i.requestFullscreen(),e.view.isFS=!0):document.webkitFullscreenEnabled?(a.log("webkitRequestFullscreen"),i.webkitRequestFullscreen(),e.view.isFS=!0):document.mozFullScreenEnabled?(i.mozRequestFullScreen(),e.view.isFS=!0):document.msFullscreenEnabled&&(i.msRequestFullscreen(),e.view.isFS=!0),e.view.isFS&&n(function(){e.view.isFSSmart=!0},300),e.resizePc(screen.width,screen.height))},e.grsPopupOFCl=function(){return e.view.isFS?"fa-"+e.params.theme.min:"fa-"+e.params.theme.max},e.$on("resize::resize",function(){var t=i.innerWidth,a=i.innerHeight,n=e.params.shatts,o=t<700||a<500,r="1"==n.lightboxfullw,s=r||o?t:n.lightboxwidth,g=r||o?a:n.lightboxheight;if(!e.view.isFS){var c=t<parseInt(s)?Math.floor(t):parseInt(s),l=parseInt(g);a<(l=t<parseInt(s)?Math.floor(l*c/parseInt(s)):l)&&(l=Math.floor(a),c=Math.floor(l*parseInt(s)/parseInt(g))),e.resizePc(c,l)}}),e.resizeToWin=function(t){e.params.shatts.lightboxfullw=t?"1":"0",e.$broadcast("resize::resize")},e.resizePc=function(t,n){if(!e.view.mainAnimationEnd&&!e.view.noEffect)return a.log("Animation in progress, trying to resize containner"),e.view.cachResActW=t,void(e.view.cachResActH=n);var o=i.innerWidth,r=i.innerHeight;if(e.view.mcw=t,e.view.mch=n,e.view.isOCC?(e.view.ccw=Math.floor(40*e.view.mcw/100),e.view.icw=e.view.mcw-e.view.ccw,e.view.ccr=0):(e.view.ccw=Math.floor(40*e.view.mcw/100),e.view.ccr=-e.view.ccw,e.view.icw=e.view.mcw),o<400||r<200){s=a.getWidthHeightForFmResize(50,parseInt(e.params.theme.filmThumbWidth),parseInt(e.params.theme.filmstripSize));e.view.fs=s.height,e.view.ftw=s.width,e.view.ftm=parseInt(parseInt(e.params.theme.filmThumbMargin)/4),e.view.fmTop=parseInt(parseInt(e.params.theme.filmstripMarginTop)/4),e.view.fmBottom=parseInt(parseInt(e.params.theme.filmstripMarginBottom)/4),e.view.ftp=0,e.view.ftbw=0}else if(o<700||r<500){var s=a.getWidthHeightForFmResize(80,parseInt(e.params.theme.filmThumbWidth),parseInt(e.params.theme.filmstripSize));e.view.fs=s.height,e.view.ftw=s.width,e.view.ftm=parseInt(parseInt(e.params.theme.filmThumbMargin)/2),e.view.fmTop=parseInt(parseInt(e.params.theme.filmstripMarginTop)/2),e.view.fmBottom=parseInt(parseInt(e.params.theme.filmstripMarginBottom)/2),e.view.ftp=0,e.view.ftbw=0}else e.view.fs=parseInt(e.params.theme.filmstripSize),e.view.ftw=parseInt(e.params.theme.filmThumbWidth),e.view.ftm=parseInt(e.params.theme.filmThumbMargin),e.view.fmTop=parseInt(e.params.theme.filmstripMarginTop),e.view.fmBottom=parseInt(e.params.theme.filmstripMarginBottom),e.view.ftp=parseInt(e.params.theme.filmThumbPadding),e.view.ftbw="none"!=e.params.theme.filmThumbBorderStyle?parseInt(e.params.theme.filmThumbBorderWidth):0;e.view.flp=0,e.view.fch=e.view.fs+e.view.fmTop+e.view.fmBottom+2*(e.view.ftp+e.view.ftbw),e.view.ich="1"==e.params.shatts.lightboxfilmstrip?e.view.mch-e.view.fch:e.view.mch,e.view.cbcP="bottom"==e.params.theme.filmstripPos?"top":"bottom",!e.view.contButtOp&&jQuery(".grsPopupB").outerHeight()&&(jQuery(".grsPopupBc").css(e.view.cbcP,-jQuery(".grsPopupB").outerHeight()),a.log(e.view.cbcP+" #$ "+-jQuery(".grsPopupB").outerHeight())),e.items.length>0&&e.setFW(e.view.cImInG),e.view.grsCC.length>0&&e.selectImg(e.view.grsCC.shift(),!0),e.$$phase||e.$apply()},e.clBposRes=function(){var t="";if(i.innerWidth===e.view.mcw){var a=e.params.shatts,n=e.params.theme,o=e.view.isOCC;t="1"===a.lightboxfilmstrip&&-1!==n.filmstripPos.indexOf("top")?"grsPopupCoCClosResWithFilm":"1"===a.lightboxcontbutts&&-1===n.filmstripPos.indexOf("top")?"grsPopupCoCClosResWithContButts":"grsPopupCoCClosRes",t=o?"comm":t}return t},e.grsOCC=function(t){var i=e.view;if(!i.isOCC){if(!i.mainAnimationEnd&&!i.noEffect)return a.log("Animation in progress, trying to open comments"),void(i.cachCmmAct=e.grsOCC);var n=i.mcw-i.ccw,o=""==i.active?"first":i.active,r=document.querySelector("."+o+" .forEffect"),s=document.querySelector(".grsPopupImC"),g=document.querySelector(".grsPopupCoC"),c=!!r&&r.querySelector("img");jQuery(s).animate({width:n},{duration:500,queue:!1,complete:function(){i.icw=n,i.isOCC=!0,e.items.length>0&&e.moveFC("fromImgNav",i.cImInG),e.$$phase||e.$apply()}}),jQuery(g).animate({right:0},{duration:500,queue:!1,complete:function(){e.$$phase||(i.ccr=0)}}),c&&(jQuery(r).animate({maxWidth:n},{duration:500,queue:!1,complete:function(){}}),jQuery(c).animate({maxWidth:n},{duration:500,queue:!1,complete:function(){i.grsCC.length>0&&e.selectImg(i.grsCC.shift(),!0)}}))}},e.grsCCC=function(t){var i=e.view,n=""==i.active?"first":i.active,o=document.querySelector("."+n+" .forEffect"),r=document.querySelector(".grsPopupImC"),s=document.querySelector(".grsPopupCoC"),g=!!o&&o.querySelector("img");if(!i.mainAnimationEnd&&!i.noEffect)return a.log("Animation in progress, trying to closw comments"),void(i.cachCmmAct=e.grsCCC);jQuery(r).animate({width:i.mcw},{duration:500,queue:!1,complete:function(){i.icw=i.mcw,i.isOCC=!1,e.$$phase||e.$apply()}}),jQuery(s).animate({right:-i.ccw},{duration:500,queue:!1,complete:function(){e.$$phase||(i.ccr=-i.ccw,e.items.length>0&&(i.flp=0,e.setFW(i.cImInG)))}}),g&&(jQuery(g).animate({maxWidth:i.mcw},{duration:500,queue:!1,complete:function(){i.grsCC.length>0&&e.selectImg(i.grsCC.shift(),!0)}}),jQuery(o).animate({maxWidth:i.mcw},{duration:500,queue:!1,complete:function(){}}))},e.grsCpFrSide=function(t){a.settings.closeLbOnSide&&e.grsCp()},e.grsCp=function(t){void 0!==t&&t.preventDefault(),document.fullscreenEnabled&&document.exitFullscreen?(document.exitFullscreen(),e.view.isFS=!1):document.webkitFullscreenEnabled&&document.webkitExitFullscreen?(document.webkitExitFullscreen(),e.view.isFS=!1):document.mozFullScreenEnabled&&document.mozCancelFullScreen?(document.mozCancelFullScreen(),e.view.isFS=!1):document.msFullscreenEnabled&&document.msExitFullscreen&&(document.msExitFullscreen(),e.view.isFS=!1),jQuery("html, body").removeClass("grsPopupParents");var i={};i.show=!1,i.grs=0,i.gallId=0,i.shatts={},i.theme={},i.pI=[],i.items=[],i.cP=0,i.pC=0,i.tC=0,i.lC=0,i.index=0,e.clearLh(),a.setPopObj(i)},e.setEffect=function(t){if("random"!=t){for(var a in e.grsEffects)for(var i in e.grsEffects[a].effects)if(i==t){e.view.effect.obj=e.grsEffects[a].effects[i],e.view.effect.name=i,e.view.effect.func=e.grsEffects[a].doEffect,e.view.effect.type=a;break}}else e.setRandomEffect()},e.setRandomEffect=function(){var t=0,a=e.getRandomNum(0,Object.keys(e.grsEffects).length-1);for(var i in e.grsEffects){if(t==a){var n=0,o=e.getRandomNum(0,Object.keys(e.grsEffects[i].effects).length);for(var r in e.grsEffects[i].effects){if(n==o){e.view.effect.obj=e.grsEffects[i].effects[r],e.view.effect.name=r,e.view.effect.func=e.grsEffects[i].doEffect,e.view.effect.type=i;break}n++}}t++}},e.getRandomNum=function(e,t){return Math.floor(Math.random()*t)+e},e.grsNoEffect=function(t,a){"first"==e.view.active?(e.psImg=a,e.view.actImg="second",e.view.active="second"):"second"==e.view.active&&(e.img=a,e.view.actImg="first",e.view.active="first"),e.view.enAp&&e.doAutoPlay(),e.$$phase||e.$apply()},e.grsNoCuting=function(t,a){"first"===e.view.active?(e.view.active="second",e.psImg=a):"second"===e.view.active&&(e.view.active="first",e.img=a),e.$$phase||e.$apply()},e.grsXcutting=function(t,a){var i,n,o,r,s,g=e.view;"first"===g.active?(i=e.img,o=e.getLightboxImageSource(i,g.icw,g.ich,"main"),r="first",s="second",e.psImg=a,g.active="second",g.actImg="second"):(n=e.psImg,o=e.getLightboxImageSource(n,g.icw,g.ich,"main"),r="second",s="first",e.img=a,g.active="first",g.actImg="first");var c=document.querySelector("div."+r),l=document.querySelector("div."+s),m=c.querySelector("img");l.querySelector("img");e.$$phase||e.$apply();var p=c.childNodes[2].childNodes[1],u=p.childNodes[2],h=l.childNodes[2].childNodes[1],d=h.childNodes[2],f=m.getBoundingClientRect(),v=f.width,w=f.height,I=Math.floor(v/11);u&&p.removeChild(u),d&&h.removeChild(d);var C=document.createElement("div");C.style.width=12*I+"px",C.style.height=w+"px",C.style.position="absolute",C.style.top="0px",C.style.left="0px",C.style.textAlign="left",C.setAttribute("class","forlyalya");for(var b=e.effectsTiming.msForEffHor,y=0;y<12;y++){var P=y*I*-1,A=50*y,S=1500;11===y&&(A=50*(y-1)),"Safari"===e.browser.name&&(A=0,S=b[y]);var x=document.createElement("div");x.setAttribute("style","width:"+I+"px;height:"+w+"px;position:absolute;left:"+y*I+"px;top:0px;padding:0px;"+t.transformStyle+'margin:0px;background:url("'+o+'") no-repeat '+P+"px 0px;background-size:"+v+"px "+w+"px;-webkit-animation:"+t.name+" "+S+"ms ease-in-out "+A+"ms 1 normal both;-moz-animation:"+t.name+" "+S+"ms ease-in-out "+A+"ms 1 normal both;-ms-animation:"+t.name+" "+S+"ms ease-in-out "+A+"ms 1 normal both;-o-animation:"+t.name+" "+S+"ms ease-in-out "+A+"ms 1 normal both;animation:"+t.name+" "+S+"ms ease-in-out "+A+"ms 1 normal both;"),x.setAttribute("class","grsXorYCutMiniTransElem_"+y),C.appendChild(x)}p.appendChild(C)},e.grsYcutting=function(t,a){if("first"==e.view.active){var i=e.img,n=e.getLightboxImageSource(i,e.view.icw,e.view.ich,"main"),o="first",r="second";e.psImg=a,e.view.active="second",e.view.actImg="second"}else{var s=e.psImg,n=e.getLightboxImageSource(s,e.view.icw,e.view.ich,"main"),o="second",r="first";e.img=a,e.view.active="first",e.view.actImg="first"}var g=document.querySelector("div."+o),c=document.querySelector("div."+r),l=g.querySelector("img");c.querySelector("img");e.$$phase||e.$apply();var m=g.childNodes[2].childNodes[1],p=m.childNodes[2],u=c.childNodes[2].childNodes[1],h=u.childNodes[2],d=l.getBoundingClientRect(),f=d.width,v=d.height,w=Math.floor(v/11);p&&m.removeChild(p),h&&u.removeChild(h);var I=document.createElement("div");I.style.width=f+"px",I.style.height=12*w+"px",I.style.position="absolute",I.style.top="0px",I.style.left="0px",I.style.textAlign="left",I.setAttribute("class","forlyalya");for(var C=e.effectsTiming.msForEffHor,b=0;b<12;b++){var y=b*w*-1,P=50*b,A=1500;11==b&&(P=50*(b-1)),"Safari"==e.browser.name&&(P=0,A=C[b]);var S=document.createElement("div");S.setAttribute("style","width:"+f+"px;height:"+w+"px;position:absolute;left:0px;top:"+b*w+"px;"+t.transformStyle+'background:url("'+n+'") no-repeat 0px '+y+"px;background-size:"+f+"px "+v+"px;-webkit-animation:"+t.name+" "+A+"ms ease-in "+P+"ms 1 normal both;-moz-animation:"+t.name+" "+A+"ms ease-in "+P+"ms 1 normal both;-ms-animation:"+t.name+" "+A+"ms ease-in "+P+"ms 1 normal both;-o-animation:"+t.name+" "+A+"ms ease-in "+P+"ms 1 normal both;animation:"+t.name+" "+A+"ms ease-in "+P+'ms 1 normal both;" '),S.setAttribute("class","grsXorYCutMiniTransElem_"+b),I.appendChild(S)}m.appendChild(I)},e.grsXYcutting=function(t,a){if("first"==e.view.active){var i=e.img,n=e.getLightboxImageSource(i,e.view.icw,e.view.ich,"main"),o="first",r="second";e.psImg=a,e.view.active="second",e.view.actImg="second"}else{var s=e.psImg,n=e.getLightboxImageSource(s,e.view.icw,e.view.ich,"main"),o="second",r="first";e.img=a,e.view.active="first",e.view.actImg="first"}var g=document.querySelector("div."+o),c=document.querySelector("div."+r),l=g.querySelector("img");c.querySelector("img");e.$$phase||e.$apply();var m=g.childNodes[2].childNodes[1],p=m.childNodes[2],u=c.childNodes[2].childNodes[1],h=u.childNodes[2],d=l.getBoundingClientRect(),f=d.width,v=d.height,w=Math.floor(f/5),I=Math.floor(v/5),C=document.createElement("div");C.style.width=6*w+"px",C.style.height=6*I+"px",C.style.position="absolute",C.style.top="0px",C.style.left="0px",C.style.textAlign="left",C.setAttribute("class","forlyalya"),p&&m.removeChild(p),h&&u.removeChild(h);for(var b=0,y=0,P=e.effectsTiming.msForEff,A=0;A<6;A++){y="fun"==t.type?70*A+50*A:0;for(var S=0;S<6;S++){var x=A*I*-1,k=S*w*-1,E=1e3;y="fun"==t.type?y+70:30*b,"Safari"==e.browser.name&&(y=0,E=P[b]);var $=document.createElement("div");$.setAttribute("style","width:"+w+"px;height:"+I+"px;float:left;"+t.transformStyle+'background:url("'+n+'") no-repeat '+k+"px "+x+"px;background-size:"+f+"px "+v+"px;-webkit-animation:"+t.name+" "+E+"ms ease-in-out "+y+"ms 1 normal both;-moz-animation:"+t.name+" "+E+"ms ease-in-out "+y+"ms 1 normal both;-ms-animation:"+t.name+" "+E+"ms ease-in-out "+y+"ms 1 normal both;-o-animation:"+t.name+" "+E+"ms ease-in-out "+y+"ms 1 normal both;animation:"+t.name+" "+E+"ms ease-in-out "+y+'ms 1 normal both;" '),$.setAttribute("class","grsXYCutMiniTransElem_"+b),C.appendChild($),b++}}m.appendChild(C)},e.grsXYcuttingIn=function(t,a){if("first"==e.view.active){var i="first",n="second";e.psImg=a,e.view.active="second"}else{var i="second",n="first";e.img=a,e.view.active="first"}var o=document.querySelector("div."+i),r=document.querySelector("div."+n),s=(o.querySelector("img"),r.querySelector("img")),g=e.getLightboxImageSource(a,e.view.icw,e.view.ich,"main");s.setAttribute("src",g),e.$$phase||e.$apply(),e.view.actImg="second"==e.view.active?"first":"second";var c=o.childNodes[2].childNodes[1],l=c.childNodes[2],m=r.childNodes[2].childNodes[1],p=m.childNodes[2],u=s.clientWidth,h=s.clientHeight;l&&c.removeChild(l),p&&m.removeChild(p);var d=Math.floor(u/5),f=Math.floor(h/5),v=document.createElement("div");v.style.width=6*d+"px",v.style.height=6*f+"px",v.style.position="absolute",v.style.top="0px",v.style.left="0px",v.style.textAlign="left",v.setAttribute("class","forlyalya");for(var w=0,I=0,C=e.effectsTiming.msForEff,b=0;b<6;b++){I="fun"==t.type?50*b+50*b:0;for(var y=0;y<6;y++){var P=b*f*-1,A=y*d*-1,S=1200;I="fun"==t.type?I+50:30*w,"Safari"==e.browser.name&&(I=0,S=C[w]);var x=document.createElement("div");x.setAttribute("style","width:"+d+"px;height:"+f+"px;float:left;"+t.transformStyle+'background:url("'+g+'") no-repeat '+A+"px "+P+"px;background-size:"+u+"px "+h+"px;-webkit-animation:"+t.name+" "+S+"ms ease-in-out "+I+"ms 1 normal both;-moz-animation:"+t.name+" "+S+"ms ease-in-out "+I+"ms 1 normal both;-ms-animation:"+t.name+" "+S+"ms ease-in-out "+I+"ms 1 normal both;-o-animation:"+t.name+" "+S+"ms ease-in-out "+I+"ms 1 normal both;animation:"+t.name+" "+S+"ms ease-in-out "+I+'ms 1 normal both;" '),x.setAttribute("class","grsXYInCutMiniTransElem_"+w),v.appendChild(x),w++}}m.appendChild(v)},e.classFfI=function(){return"noCutting"!=e.view.effect.type?"first"==e.view.actImg?"opset":"opzero":void 0===e.view.firstIn?"opzero":"opset"},e.classFsI=function(){return"noCutting"!=e.view.effect.type?"second"==e.view.actImg?"opset":"opzero":void 0===e.view.firstIn?"opzero":e.view.firstIn?"opzero":"opset"},e.classFfD=function(){return e[e.view.effect.type+"_fD"]()},e.classFsD=function(){return e[e.view.effect.type+"_sD"]()},e.noEffect_fD=function(){return"first"===e.view.active?"active":"pasive"},e.noEffect_sD=function(){return"second"===e.view.active?"active":"pasive"},e.noCutting_fD=function(){return"first"===e.view.active?e.view.effect.obj.in+" active":"second"===e.view.active?e.view.effect.obj.out+" pasive":void 0},e.noCutting_sD=function(){return"second"===e.view.active?e.view.effect.obj.in+" active":"first"===e.view.active?e.view.effect.obj.out+" pasive":void 0},e.cuttingX_fD=function(){return(e.view.firstIn?"grsFrInEff ":"")+("first"==e.view.active?e.view.effect.obj.activeC+" active":"")},e.cuttingX_sD=function(){return"second"==e.view.active?e.view.effect.obj.activeC+" active":""},e.cuttingY_fD=function(){return(e.view.firstIn?"grsFrInEff ":"")+("first"==e.view.active?e.view.effect.obj.activeC+" active":"")},e.cuttingY_sD=function(){return"second"==e.view.active?e.view.effect.obj.activeC+" active":""},e.cuttingXY_fD=function(){return(e.view.firstIn?"grsFrInEff ":"")+("first"==e.view.active?e.view.effect.obj.activeC+" active":"")},e.cuttingXY_sD=function(){return"second"==e.view.active?e.view.effect.obj.activeC+" active":""},e.cuttingXYIn_fD=function(){return(e.view.firstIn?"grsFrInEff ":"")+("first"==e.view.active?"grsFadeIn grsAnDur active":e.view.effect.obj.pasiveC)},e.cuttingXYIn_sD=function(){return"second"==e.view.active?"grsFadeIn grsAnDur active":e.view.effect.obj.pasiveC},e.PrefixedEvent=function(t){for(var i=e.browser.pfx,n=0;n<i.length;n++)i[n]||(t=t.toLowerCase()),document.querySelector("body").addEventListener(i[n]+t,function(i){if("animationend"==t){if(-1!=i.target.getAttribute("class").indexOf("grsFrInEff"))return a.log('end of first "in" grsFrInEff'),e.view.mainAnimationEnd=!0,e.view.firstIn=!1,void 0!==e.view.cachResActW?(e.resizePc(e.view.cachResActW,e.view.cachResActH),delete e.view.cachResActW,void delete e.view.cachResActH):void 0!==e.view.cachCmmAct?(e.view.cachCmmAct(),void delete e.view.cachCmmAct):e.view.grsCC.length>0?(e.selectImg(e.view.grsCC.shift(),!0),void e.$apply()):(e.view.enAp&&e.doAutoPlay(),a.log('end of first "in" !scope.$$phase --- '+!e.$$phase),void e.$apply());if(-1!=i.target.getAttribute("class").indexOf("inAnimationEnd")){if(a.log("inAnimationEnd anim ------------------- "),e.view.inAnimationEnd=!0,a.log("scope.view.inAnimationEnd --- "+e.view.inAnimationEnd),a.log("scope.view.outAnimationEnd --- "+e.view.outAnimationEnd),!e.view.outAnimationEnd)return;return e.view.firstIn=!1,e.view.mainAnimationEnd=!0,void 0!==e.view.cachResActW?(e.resizePc(e.view.cachResActW,e.view.cachResActH),delete e.view.cachResActW,void delete e.view.cachResActH):void 0!==e.view.cachCmmAct?(e.view.cachCmmAct(),void delete e.view.cachCmmAct):e.view.grsCC.length>0?(a.log("scope.view.grsCC.shift in ------------- "),a.log(e.view.grsCC),e.selectImg(e.view.grsCC.shift(),!0),void e.$apply()):(e.view.enAp&&e.doAutoPlay(),void e.$apply())}if(-1!=i.target.getAttribute("class").indexOf("outAnimationEnd")){if(a.log("outAnimationEnd anim ------------- "),e.view.outAnimationEnd=!0,a.log("scope.view.outAnimationEnd --- "+e.view.outAnimationEnd),a.log("scope.view.inAnimationEnd --- "+e.view.inAnimationEnd),!e.view.inAnimationEnd)return;return e.view.firstIn=!1,e.view.mainAnimationEnd=!0,void 0!==e.view.cachResActW?(e.resizePc(e.view.cachResActW,e.view.cachResActH),delete e.view.cachResActW,void delete e.view.cachResActH):void 0!==e.view.cachCmmAct?(e.view.cachCmmAct(),void delete e.view.cachCmmAct):(e.view.grsCC.length>0&&(a.log("scope.view.grsCC.shift ------------- "),a.log(e.view.grsCC),e.selectImg(e.view.grsCC.shift(),!0)),e.view.enAp&&e.doAutoPlay(),void e.$apply())}if(-1!=i.target.getAttribute("class").indexOf("grsXorYCutMiniTransElem_11"))return e.view.mainAnimationEnd=!0,void 0!==e.view.cachResActW?(e.resizePc(e.view.cachResActW,e.view.cachResActH),delete e.view.cachResActW,void delete e.view.cachResActH):void 0!==e.view.cachCmmAct?(e.view.cachCmmAct(),void delete e.view.cachCmmAct):e.view.grsCC.length>0?(e.selectImg(e.view.grsCC.shift(),!0),void e.$apply()):(e.view.enAp&&e.doAutoPlay(),a.log("grsXorYCutMiniTransElem_11 end ---------- "),a.log(e.view.grsCC),void e.$apply());if(-1!=i.target.getAttribute("class").indexOf("grsXYCutMiniTransElem_35"))return e.view.mainAnimationEnd=!0,void 0!==e.view.cachResActW?(e.resizePc(e.view.cachResActW,e.view.cachResActH),delete e.view.cachResActW,void delete e.view.cachResActH):void 0!==e.view.cachCmmAct?(e.view.cachCmmAct(),void delete e.view.cachCmmAct):e.view.grsCC.length>0?(e.selectImg(e.view.grsCC.shift(),!0),void e.$apply()):(e.view.enAp&&e.doAutoPlay(),a.log("grsXYCutMiniTransElem_35 end ---------- "),a.log(e.view.grsCC),void e.$apply());if(-1!=i.target.getAttribute("class").indexOf("grsXYInCutMiniTransElem_35")){e.view.actImg="second"==e.view.actImg?"first":"second",e.view.mainAnimationEnd=!0;var n=document.querySelector("div."+e.view.active).childNodes[2].childNodes[1];return forlyalya=n.childNodes[2],forlyalya&&n.removeChild(forlyalya),void 0!==e.view.cachResActW?(e.resizePc(e.view.cachResActW,e.view.cachResActH),delete e.view.cachResActW,delete e.view.cachResActH,void e.$apply()):void 0!==e.view.cachCmmAct?(e.view.cachCmmAct(),delete e.view.cachCmmAct,void e.$apply()):e.view.grsCC.length>0?(e.selectImg(e.view.grsCC.shift(),!0),void e.$apply()):(e.view.enAp&&e.doAutoPlay(),void e.$apply())}}},!1)},e.keyBoardEvents=function(){document.addEventListener("keydown",function(t){if(e.options.show){var a=t.key;if("Control"!==a)if(t.ctrlKey);else{switch(a){case"ArrowRight":case"Right":e.grsRight();break;case"ArrowLeft":case"Left":e.grsLeft();break;case"Escape":case"Esc":e.grsCp();break;case" ":case"Spacebar":break;default:return}e.$$phase||e.$apply()}}},!1)},e.fullscreenChange=function(){document.addEventListener("webkitfullscreenchange",function(t){e.view.isFSSmart&&e.grsSFM()}),document.addEventListener("mozfullscreenchange",function(t){e.view.isFSSmart&&e.grsSFM()}),document.addEventListener("fullscreenchange",function(t){e.view.isFSSmart&&e.grsSFM()}),document.addEventListener("MSFullscreenChange",function(t){e.view.isFSSmart&&e.grsSFM()})},e.PrefixedEvent("AnimationEnd"),e.keyBoardEvents(),e.fullscreenChange()}}}]),grsApp.directive("grsMosaic",["$filter","GrsFactory","GrsService","$window","$location",function(e,t,a,i,n){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:a.getViewsTemplateUrl("grsMosaic"),link:function(e,o,r){e.sortingOrder="id",e.reverse=!0,e.message={type:"success",show:!1,text:""},e.params.contHeight=50,e.params.contHeightFirstBinding=!1,e.params.loadedCount=0,e.pageination={forGallery:!0,grs:e.params.grs,items:e.params.data.images,navView:e.params.shatts.pagination,gallery:e.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(e.params.shatts.imagesperpage),orderBy:e.params.shatts.orderby,ordering:e.params.shatts.ordering,pagedItems:[],scrolling:!1,loading:!0,positioning:function(){e.MosaicPositioning()},message:function(t,a,i){e.message.show=t,e.message.text=a,e.message.type=void 0!==i?i:"success"},checkScrolling:function(){return a.log("ekanq mas scrolling"),e.checkScrolling()}},e.clickAction=function(t,a){void 0!==a&&a.preventDefault(),e["clickAction"+e.params.shatts.clickaction](t)},e.clickActiondoNothing=function(){},e.clickActionopenLightbox=function(t){var i=e.params,n=e.pageination;e.setLh(),a.setPopObj({show:!0,grs:i.grs,gallId:i.shatts.id,shatts:i.shatts,theme:i.data.theme.lightbox,orderby:i.shatts.orderby,ordering:i.shatts.ordering,items:[],pI:n.pagedItems,cP:n.currentPage,pC:n.pagesCount,tC:n.totalcount,lC:n.loadedCount,index:t})},e.clickActionopenLink=function(t){a.link(e.pageination.pagedItems[e.pageination.currentPage][t],e.params.shatts.openlinktarget)},e.$on("resize::resize",function(){e.pageination.gallExists&&(e.pageination.positioning(),e.$$phase||e.$apply())}),e.$on("scroll::scroll",function(){if("scrolling"===e.pageination.navView&&!e.pageination.loading){var t=jQuery("#grsGal"+e.params.grs),n=t.offset().top+t.innerHeight(),o=i.innerHeight;i.pageYOffset+o-n>o/10?(e.pageination.scrolling=!0,a.log("thumb mek 10ic ancanq")):e.pageination.scrolling=!1,e.$$phase||e.$apply()}}),e.checkScrolling=function(){if("scrolling"===e.pageination.navView){var t=jQuery("html").innerHeight();if(a.log("jjj "+(i.pageYOffset+i.innerHeight)),a.log("vvv "+t),a.log("grsGallHeight "+o.find(".grsImsCont").innerHeight()),i.innerHeight>=t||i.pageYOffset+i.innerHeight>t){a.log("activate scrolling"),a.log("new val for right fireing watcher");var n=e.pageination.scrolling?e.pageination.scrolling:2;return a.log("gaga"+n),n*n}return!1}},e.$watch(function(){if("scrolling"==e.pageination.navView){if(e.pageination.loading)return a.log("Height watcher loading is true"),void a.log("Height watcher loading params height "+e.params.contHeight);var t=o.find(".grsImsCont").innerHeight();0!=t?Math.round(e.params.contHeight)!=Math.round(t)?a.log("live height not set or same live height"):e.params.loadedCount!=e.pageination.loadedCount?(e.params.loadedCount=e.pageination.loadedCount,e.pageination.scrolling=e.checkScrolling()):a.log("loaded - "+e.pageination.loadedCount):a.log("Height watcher , gallCont@ der live height chuni")}}),e.imgLoaded=function(t,a){e.pageination.pagedItems[e.pageination.currentPage][t].show=!0},e.setLh=function(){n.path("/grs/"+e.params.grs).replace()},e.params.getDataById=function(t,a,i){var n={},o=0;itemsCount=e.pageination.items.length;for(var r=0;r<itemsCount;r++)if(e.pageination.items[r].id==t){o=r;break}return n.imgData=e.pageination.items[o],n.curentImgIndex=o,n},e.MosaicPositioning=function(){t["Mosaic"+a.toUpperCaseFl(e.params.shatts.type)+"Positioning"](e.params,e.pageination,"")},e.getImageSrc=function(t){var i=e.pageination.pagedItems[e.pageination.currentPage][t];return a.getImageSource(i,"mosaic")},e.grsShTC=function(){return a.grsShTC(e.params.shatts.title,e.params.data.theme.mosaic.mosaicTEffect)},e.shVIc=function(t){return a.shVIc(e.pageination.pagedItems[e.pageination.currentPage][t])},e.grsOnhv=function(){return a.grsOnhv(e.params.shatts.title)?"grsTOnhover":""},e.grsShMC=function(){return a.grsShMC(e.params.shatts.title,e.params.data.theme.mosaic.mosaicTEffect)},e.CheckGrsHash=function(){var t=i.location.hash,a=e.params.grs,n=!1;if(-1!==t.indexOf("grs")){var o=t.split("/");if(o[2]==a&&o.length>3){imageId=o.pop();for(var r=0;r<e.pageination.pagedItems[0].length;r++)if(e.pageination.pagedItems[0][r].id==imageId){n=!0;break}n?e.clickAction(r):e.clickAction("hash-"+imageId)}}},e.$watch(function(){return a.settingsReady},function(i,n){i&&t.getGalleryData(0,e.pageination.itemsPerPage,e.params.shatts.id,1,e.params.shatts.orderby,e.params.shatts.ordering,e.params.shatts.theme,e.params.shatts.view).then(function(t){e.pageination.gallExists=t.data.gallExists,e.pageination.loading=!1,e.params.data.theme.mosaic=JSON.parse(t.data.theme.mosaic),e.params.data.theme.lightbox=JSON.parse(t.data.theme.lightbox),e.pageination.pagedItems[0]=t.data.images,e.pageination.totalcount=t.data.count,e.pageination.pagesCount=Math.ceil(e.pageination.totalcount/e.pageination.itemsPerPage),e.pageination.loadedCount=e.pageination.pagesCount>0?1:0,e.pageination.gallExists&&(e.pageination.positioning(),e.CheckGrsHash())},function(e){a.log(e)})},!0)}}}]),grsApp.directive("grsMasonry",["$filter","GrsFactory","GrsService","$window","$location",function(e,t,a,i,n){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:a.getViewsTemplateUrl("grsMasonry"),link:function(e,o,r){e.sortingOrder="id",e.reverse=!0,e.message={type:"success",show:!1,text:""},e.params.contHeight=50,e.params.contHeightFirstBinding=!1,e.params.loadedCount=0,e.pageination={forGallery:!0,grs:e.params.grs,items:e.params.data.images,navView:e.params.shatts.pagination,gallery:e.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,view:e.params.shatts.pagination,itemsPerPage:parseInt(e.params.shatts.imagesperpage),orderBy:e.params.shatts.orderby,ordering:e.params.shatts.ordering,pagedItems:[],scrolling:!1,loading:!0,positioning:function(){e.MasonryPositioning()},message:function(t,a,i){e.message.show=t,e.message.text=a,e.message.type=void 0!==i?i:"success"},checkScrolling:function(){return a.log("ekanq mas scrolling"),e.checkScrolling()}},e.clickAction=function(t,a){void 0!==a&&a.preventDefault(),e["clickAction"+e.params.shatts.clickaction](t)},e.clickActiondoNothing=function(){},e.clickActionopenLightbox=function(t){var i=e.params,n=e.pageination;e.setLh(),a.setPopObj({show:!0,grs:i.grs,gallId:i.shatts.id,shatts:i.shatts,theme:i.data.theme.lightbox,orderby:i.shatts.orderby,ordering:i.shatts.ordering,items:[],pI:n.pagedItems,cP:n.currentPage,pC:n.pagesCount,tC:n.totalcount,lC:n.loadedCount,index:t})},e.clickActionopenLink=function(t){a.link(e.pageination.pagedItems[e.pageination.currentPage][t],e.params.shatts.openlinktarget)},e.$on("resize::resize",function(){e.pageination.gallExists&&(e.pageination.positioning(),e.$$phase||e.$apply())}),e.$on("scroll::scroll",function(){if("scrolling"==e.pageination.navView&&!e.pageination.loading){var t=jQuery("#grsGal"+e.params.grs).offset().top+jQuery("#grsGal"+e.params.grs).innerHeight(),a=i.innerHeight,n=i.pageYOffset+a;e.pageination.scrolling=n-t>a/10,e.$$phase||e.$apply()}}),e.checkScrolling=function(){if("scrolling"==e.pageination.navView){var t=jQuery("html").innerHeight();if(i.innerHeight>=t||i.pageYOffset+i.innerHeight>t){var a=e.pageination.scrolling?e.pageination.scrolling:2;return a*a}return!1}},e.$watch(function(){if("scrolling"==e.pageination.navView&&!e.pageination.loading){var t=o.find(".grsImsCont").innerHeight();0!=t&&(Math.round(e.params.contHeight)!=Math.round(t)?a.log("live height@ not set"):e.params.loadedCount!=e.pageination.loadedCount?(e.params.loadedCount=e.pageination.loadedCount,e.pageination.scrolling=e.checkScrolling()):a.log("loaded - "+e.pageination.loadedCount))}}),e.imgLoaded=function(t,a){e.pageination.pagedItems[e.pageination.currentPage][t].show=!0},e.setLh=function(){n.path("/grs/"+e.params.grs).replace()},e.MasonryPositioning=function(){t["Masonry"+a.toUpperCaseFl(e.params.shatts.type)+"Positioning"](e.params,e.pageination,"")},e.grsShTC=function(){return a.grsShTC(e.params.shatts.title,e.params.data.theme.masonry.masonryTEffect)},e.shVIc=function(t){return a.shVIc(e.pageination.pagedItems[e.pageination.currentPage][t])},e.grsOnhv=function(){return a.grsOnhv(e.params.shatts.title)?"grsTOnhover":""},e.grsShMC=function(){return a.grsShMC(e.params.shatts.title,e.params.data.theme.masonry.masonryTEffect)},e.getImageSrc=function(t){var i=e.pageination.pagedItems[e.pageination.currentPage][t];return a.getImageSource(i,"masonry")},e.scrollTop=function(){jQuery("html, body").animate({scrollTop:jQuery("#grsGal"+e.params.grs).offset().top-100},500)},e.CheckGrsHash=function(){var t=i.location.hash,a=e.params.grs,n=!1;if(-1!==t.indexOf("grs")){var o=t.split("/");if(o[2]==a&&o.length>3){imageId=o.pop();for(var r=0;r<e.pageination.pagedItems[0].length;r++)if(e.pageination.pagedItems[0][r].id==imageId){n=!0;break}n?e.clickAction(r):e.clickAction("hash-"+imageId)}}},e.$watch(function(){return a.settingsReady},function(i,n){i&&t.getGalleryData(0,e.pageination.itemsPerPage,e.params.shatts.id,1,e.params.shatts.orderby,e.params.shatts.ordering,e.params.shatts.theme,e.params.shatts.view).then(function(t){e.pageination.gallExists=t.data.gallExists,e.pageination.loading=!1,e.params.data.theme.masonry=JSON.parse(t.data.theme.masonry),e.params.data.theme.lightbox=JSON.parse(t.data.theme.lightbox),e.pageination.pagedItems[0]=t.data.images,e.pageination.totalcount=t.data.count,e.pageination.pagesCount=Math.ceil(e.pageination.totalcount/e.pageination.itemsPerPage),e.pageination.loadedCount=e.pageination.pagesCount>0?1:0,e.pageination.gallExists&&(e.pageination.positioning(),e.CheckGrsHash())},function(e){a.log(e)})},!0)}}}]),grsApp.directive("grsThumbnail",["$filter","GrsFactory","GrsService","$window","$location",function(e,t,a,i,n){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:a.getViewsTemplateUrl("grsThumbnail"),link:function(e,o,r){e.sortingOrder="id",e.reverse=!0,e.message={type:"success",show:!1,text:""},a.log(e.params),e.params.contHeight=50,e.params.contHeightFirstBinding=!1,e.params.loadedCount=0,e.pageination={forGallery:!0,grs:e.params.grs,items:[],navView:e.params.shatts.pagination,gallery:e.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(e.params.shatts.imagesperpage),orderBy:e.params.shatts.orderby,ordering:e.params.shatts.ordering,pagedItems:[],scrolling:!1,loading:!0,positioning:function(){t.ThumbnailPositioning(e.params,this,"")},message:function(t,a,i){e.message.show=t,e.message.text=a,e.message.type=void 0!==i?i:"success"},checkScrolling:function(){return a.log("ekanq mas scrolling"),e.checkScrolling()}},e.clickAction=function(t,a){void 0!==a&&a.preventDefault(),e["clickAction"+e.params.shatts.clickaction](t)},e.clickActiondoNothing=function(){},e.clickActionopenLightbox=function(t){var i=e.params,n=e.pageination;e.setLh(),a.setPopObj({show:!0,grs:i.grs,gallId:i.shatts.id,shatts:i.shatts,theme:i.data.theme.lightbox,orderby:i.shatts.orderby,ordering:i.shatts.ordering,items:[],pI:n.pagedItems,cP:n.currentPage,pC:n.pagesCount,tC:n.totalcount,lC:n.loadedCount,index:t})},e.clickActionopenLink=function(t){a.link(e.pageination.pagedItems[e.pageination.currentPage][t],e.params.shatts.openlinktarget)},e.$on("resize::resize",function(){e.pageination.gallExists&&(e.pageination.positioning(),e.$$phase||e.$apply())}),e.$on("scroll::scroll",function(){if("scrolling"===e.pageination.navView&&!e.pageination.loading){var t=jQuery("#grsGal"+e.params.grs),n=t.offset().top+t.innerHeight(),o=i.innerHeight;i.pageYOffset+o-n>o/10?(e.pageination.scrolling=!0,a.log("thumb mek 10ic ancanq")):e.pageination.scrolling=!1,e.$$phase||e.$apply()}}),e.checkScrolling=function(){if("scrolling"===e.pageination.navView){var t=jQuery("html").innerHeight();if(i.innerHeight>=t||i.pageYOffset+i.innerHeight>t){var a=e.pageination.scrolling?e.pageination.scrolling:2;return a*a}return!1}},e.$watch(function(){if("scrolling"===e.pageination.navView&&!e.pageination.loading){var t=o.find(".grsImsCont").innerHeight();0!=t?Math.round(e.params.contHeight)===Math.round(t)?e.params.loadedCount!=e.pageination.loadedCount&&(e.params.loadedCount=e.pageination.loadedCount,e.pageination.scrolling=e.checkScrolling()):a.log("live height@ not set"):a.log("Height watcher , gallCont@ der live height chuni")}}),e.imgLoaded=function(t,a){e.pageination.pagedItems[e.pageination.currentPage][t].show=!0},e.setLh=function(){n.path("/grs/"+e.params.grs).replace()},e.polOn=function(t){return parseInt(e.params.shatts.polaroid)?t%3==0?"pol_0 pol":(t%3==1?"pol_1":"pol_2")+" pol":""},e.grsShTC=function(){return a.grsShTC(e.params.shatts.title,e.params.data.theme.thumbnail.thumbnailTEffect)},e.grsOnhv=function(){return a.grsOnhv(e.params.shatts.title)?"grsTOnhover":""},e.shVIc=function(t){return a.shVIc(e.pageination.pagedItems[e.pageination.currentPage][t])},e.grsShMC=function(){return a.grsShMC(e.params.shatts.title,e.params.data.theme.thumbnail.thumbnailTEffect)},e.getImageSrc=function(t){var i=e.pageination.pagedItems[e.pageination.currentPage][t];return a.getImageSource(i,"thumbnail")},e.CheckGrsHash=function(){var t=i.location.hash,a=e.params.grs,n=!1;if(-1!==t.indexOf("grs")){var o=t.split("/");if(o[2]==a&&o.length>3){imageId=o.pop();for(var r=0;r<e.pageination.pagedItems[0].length;r++)if(e.pageination.pagedItems[0][r].id==imageId){n=!0;break}n?e.clickAction(r):e.clickAction("hash-"+imageId)}}},e.$watch(function(){return a.settingsReady},function(i,n){i&&t.getGalleryData(0,e.pageination.itemsPerPage,e.params.shatts.id,1,e.params.shatts.orderby,e.params.shatts.ordering,e.params.shatts.theme,e.params.shatts.view).then(function(t){a.log(t),e.pageination.gallExists=t.data.gallExists,e.pageination.loading=!1,e.params.data.theme.thumbnail=JSON.parse(t.data.theme.thumbnail),e.params.data.theme.lightbox=JSON.parse(t.data.theme.lightbox),e.pageination.pagedItems[0]=t.data.images,e.pageination.totalcount=t.data.count,e.pageination.pagesCount=Math.ceil(e.pageination.totalcount/e.pageination.itemsPerPage),e.pageination.loadedCount=e.pageination.pagesCount>0?1:0,e.pageination.gallExists&&(e.pageination.positioning(),e.CheckGrsHash())},function(e){a.log(e)})},!0)}}}]),grsApp.directive("grsFilm",["$filter","GrsFactory","GrsService","$window","$location",function(e,t,a,i,n){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:a.getViewsTemplateUrl("grsFilm"),link:function(e,o,r){e.sortingOrder="id",e.reverse=!0,e.message={type:"success",show:!1,text:""},e.params.contHeight=50,e.params.flp=0,e.params.contHeightFirstBinding=!1,e.params.loadedCount=0,e.pageination={forGallery:!0,grs:e.params.grs,items:[],navView:"scrolling",gallery:e.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(e.params.shatts.imagesperpage),orderBy:e.params.shatts.orderby,ordering:e.params.shatts.ordering,pagedItems:[],scrolling:!1,loading:!0,positioning:function(){t.FilmPositioning(e.params,this,e.moveFC)},message:function(t,a,i){e.message.show=t,e.message.text=a,e.message.type=angular.isUndefined(i)?"success":i},checkScrolling:function(){return a.log("ekanq mas scrolling"),e.checkScrolling()}},e.hideNav=function(){var t=e.params,a=e.pageination;return!(a.pagesCount>a.loadedCount)&&t.contWidth+-1*t.flp>=t.flWidth},e.moveFC=function(t){function i(e,t){var a=t?-1*parseInt(e/l):parseInt((g-(c+-1*e))/l);if(a>0){var i=u>a?a:u;t?e+=i*l:e-=i*l}return e}var n,o=e.params.flp,r=e.params,s=r.data.theme.film,g=r.flWidth,c=r.contWidth,l=parseInt(r.shatts.width)+parseInt(s.fmThumbMargin)+2*(parseInt(s.fmThumbPadding)+("none"!==s.fmThumbBorderStyle?parseInt(s.fmThumbBorderWidth):0)),m=a.settings.filmImMoveCount,p=Math.floor(Math.floor(c/l)/2),u=p<m?0===p?1:p:m;if("left"===t){if(c+-1*o>=g)return void(e.pageination.scrolling=!0);n=i(o-(g-(c+-1*o))%l,!1)}else if("right"===t){if(0===o)return;n=i(o+-1*o%l,!0)}e.params.flp=n},"scroll"!==e.params.shatts.nav&&"both"!==e.params.shatts.nav||o.find(".grsFilm").bind("mousewheel DOMMouseScroll",function(t){var a=t.originalEvent.wheelDelta,i=t.originalEvent.detail;angular.isUndefined(a)?angular.isUndefined(i)||(i>0?e.moveFC("left"):e.moveFC("right")):a>0?e.moveFC("right"):e.moveFC("left"),t.preventDefault(),e.$$phase||e.$apply()}),e.clickAction=function(t,a){void 0!==a&&a.preventDefault(),e["clickAction"+e.params.shatts.clickaction](t)},e.clickActiondoNothing=function(){},e.clickActionopenLightbox=function(t){var i=e.params,n=e.pageination;e.setLh(),a.setPopObj({show:!0,grs:i.grs,gallId:i.shatts.id,shatts:i.shatts,theme:i.data.theme.lightbox,orderby:i.shatts.orderby,ordering:i.shatts.ordering,items:[],pI:n.pagedItems,cP:n.currentPage,pC:n.pagesCount,tC:n.totalcount,lC:n.loadedCount,index:t})},e.clickActionopenLink=function(t){a.link(e.pageination.pagedItems[e.pageination.currentPage][t],e.params.shatts.openlinktarget)},e.$on("resize::resize",function(){e.pageination.gallExists&&(e.pageination.positioning(),e.$$phase||e.$apply())}),e.imgLoaded=function(t,a){e.pageination.pagedItems[e.pageination.currentPage][t].show=!0},e.setLh=function(){n.path("/grs/"+e.params.grs).replace()},e.navType=function(){var t=e.params.shatts.nav;return"both"===t||"buttons"===t},e.grsShTC=function(){return a.grsShTC(e.params.shatts.title,e.params.data.theme.film.fmThumbTEffect)},e.grsOnhv=function(){return a.grsOnhv(e.params.shatts.title)?"grsTOnhover":""},e.shVIc=function(t){return a.shVIc(e.pageination.pagedItems[e.pageination.currentPage][t])},e.grsShMC=function(){return a.grsShMC(e.params.shatts.title,e.params.data.theme.film.fmThumbTEffect)},e.shFilm=function(){return e.pageination.loadedCount>0},e.getImageSrc=function(t){var i=e.pageination.pagedItems[e.pageination.currentPage][t],n=e.params;return i.thumbWidth=n.thumbWidth,i.thumbHeight=n.thumbHeight,a.getImageSource(i,"thumbnail")},e.CheckGrsHash=function(){var t=i.location.hash,a=e.params.grs,n=!1;if(-1!==t.indexOf("grs")){var o=t.split("/");if(o[2]==a&&o.length>3){imageId=o.pop();for(var r=0;r<e.pageination.pagedItems[0].length;r++)if(e.pageination.pagedItems[0][r].id==imageId){n=!0;break}n?e.clickAction(r):e.clickAction("hash-"+imageId)}}},e.$watch(function(){return a.settingsReady},function(i,n){i&&t.getGalleryData(0,e.pageination.itemsPerPage,e.params.shatts.id,1,e.params.shatts.orderby,e.params.shatts.ordering,e.params.shatts.theme,e.params.shatts.view).then(function(i){a.log(i),e.pageination.gallExists=i.data.gallExists,e.pageination.loading=!1,e.params.data.theme.film=JSON.parse(i.data.theme.film),e.params.data.theme.lightbox=JSON.parse(i.data.theme.lightbox),e.pageination.pagedItems[0]=i.data.images,e.pageination.totalcount=i.data.count,e.pageination.pagesCount=Math.ceil(e.pageination.totalcount/e.pageination.itemsPerPage),e.pageination.loadedCount=e.pageination.pagesCount>0?1:0,e.pageination.gallExists&&(t.FilmPositioning(e.params,e.pageination),e.CheckGrsHash())},function(e){a.log(e)})},!0)}}}]),grsApp.directive("grsAlbum",["$filter","GrsFactory","GrsService","$window","$location",function(e,t,a,i,n){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:a.getViewsTemplateUrl("grsAlbum"),link:function(e,o,r){e.message={type:"success",show:!1,text:""},e.grsHash=[],e.toUpperCaseFl=function(e){return a.toUpperCaseFl(e)},e.options={grsMainView:a.getViewsTemplateUrl("grsAlbum"+e.params.shatts.mainview),grsGalView:a.getViewsTemplateUrl("grs"+e.params.shatts.galview),albVerHor:"Thumbnail"!==e.params.shatts.mainview?e.toUpperCaseFl(e.params.shatts.masmostype):"",galVerHor:"Thumbnail"!==e.params.shatts.galview?e.toUpperCaseFl(e.params.shatts.galmasmostype):"",albumView:!0,albThRes:{},back:!1,eStack:[]},e.params.contHeight=50,e.params.contHeightFirstBinding=!1,e.params.loadedCount=0,e.params.albumView=e.options.albumView,e.messageF=function(t,a,i){e.message.show=t,e.message.text=a,e.message.type=angular.isUndefined(i)?"success":i},e.mainPageination={forGallery:!1,grs:e.params.grs,items:[],navView:e.params.shatts.pagination,album:e.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(e.params.shatts.imagesperpage),orderBy:e.params.shatts.orderby,ordering:e.params.shatts.ordering,pagedItems:[],scrolling:!1,loading:!0,positioning:function(){t[e.params.shatts.mainview+e.options.albVerHor+"Positioning"](e.params,this,".grsAlbum")},message:e.messageF,checkScrolling:function(){return a.log("ekanq mas scrolling"),e.checkScrolling()}},e.pageination={forGallery:!0,grs:e.params.grs,items:[],navView:e.params.shatts.pagination,gallery:0,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(e.params.shatts.imagesperpage),orderBy:e.params.shatts.galorderby,ordering:e.params.shatts.galordering,pagedItems:[],scrolling:!1,loading:!1,positioning:function(){t[e.params.shatts.galview+e.options.galVerHor+"Positioning"](e.params,this,"")},message:e.messageF,checkScrolling:function(){return a.log("ekanq album scrolling"),e.checkScrolling()}},e.$on("resize::resize",function(){(e.mainPageination.albExists||e.pageination.gallExists)&&(e.params.albumView=e.options.albumView,(e.options.albumView?e.mainPageination:e.pageination).positioning(),e.$$phase||e.$apply())}),e.$on("scroll::scroll",function(){if("scrolling"===e.mainPageination.navView){var t=e.options.albumView?e.mainPageination:e.pageination;if(!t.loading){var a=jQuery("#grsGal"+e.params.grs),n=a.offset().top+a.innerHeight(),o=i.innerHeight,r=i.pageYOffset+o;t.scrolling=r-n>o/10,e.$$phase||e.$apply()}}}),e.checkScrolling=function(){if("scrolling"===e.mainPageination.navView){var t=jQuery("html").innerHeight();if(i.innerHeight>=t||i.pageYOffset+i.innerHeight>t){var a=e.options.albumView?e.mainPageination.scrolling:e.pageination.scrolling;return newVal=a||2,newVal*newVal}return!1}},e.$watch(function(){if("scrolling"===e.mainPageination.navView){var t=e.options.albumView?e.mainPageination:e.pageination;if(!t.loading){var i=o.find(".grsImsCont").innerHeight();0!=i&&(Math.round(e.params.contHeight)!=Math.round(i)?a.log("live height@ not set"):e.params.loadedCount!=t.loadedCount?(e.params.loadedCount=t.loadedCount,t.scrolling=e.checkScrolling()):a.log("loaded - "+t.loadedCount))}}}),e.scrollTop=function(){jQuery("html, body").animate({scrollTop:jQuery("#grsGal"+e.params.grs).offset().top-100},500)},e.grsShTC=function(){var t=e.options.albumView?"mainview":"galview",i=e.options.albumView?"title":"galtitle",n=e.params.shatts[t].toLowerCase()+"TEffect";return a.grsShTC(e.params.shatts[i],e.params.data.theme[e.params.shatts[t].toLowerCase()][n])},e.shVIc=function(t){return a.shVIc(e.pageination.pagedItems[e.pageination.currentPage][t])},e.grsShMC=function(){var t=e.options.albumView?"mainview":"galview",i=e.options.albumView?"title":"galtitle",n=e.params.shatts[t].toLowerCase()+"TEffect";return a.grsShMC(e.params.shatts[i],e.params.data.theme[e.params.shatts[t].toLowerCase()][n])},e.grsOnhv=function(){var t=e.options.albumView?"title":"galtitle";return a.grsOnhv(e.params.shatts[t])?"grsTOnhover":""},e.clickAction=function(t,a){void 0!==a&&a.preventDefault(),e["clickAction"+e.params.shatts.galclickaction](t)},e.clickActiondoNothing=function(){},e.clickActionopenLightbox=function(t){var i=e.params,n=e.pageination;e.setLh(),a.setPopObj({show:!0,grs:i.grs,gallId:n.gallery,shatts:i.shatts,theme:i.data.theme.lightbox,orderby:i.shatts.galorderby,ordering:i.shatts.galordering,items:[],pI:n.pagedItems,cP:n.currentPage,pC:n.pagesCount,tC:n.totalcount,lC:n.loadedCount,index:t})},e.clickActionopenLink=function(t){a.link(e.pageination.pagedItems[e.pageination.currentPage][t],e.params.shatts.galopenlinktarget)},e.imgLoaded=function(t,a){var i=e.options.albumView?"mainPageination":"pageination";e[i].pagedItems[e[i].currentPage][t].show=!0},e.setLh=function(){for(var t="/grs/"+e.params.grs,a=e.options.albumView,i=a?"album":"gallery",o=(a?e.mainPageination:e.pageination)[i],r=e.options.eStack,s=r.length,g=1;g<s;g++)t+="/album/"+r[g].albId;t=0!=s?t+"/"+i+"/"+o:"",n.path(t).replace()},e.CheckGrsHash=function(){var t=i.location.hash,a=e.params.grs;if(-1!==t.indexOf("grs")){var n=t.split("/");if(n[2]==a){for(var o=3,r=4;o<n.length;o+=2,r+=2)e.grsHash.push({type:n[o],id:n[r]});if(e.grsHash.length){e.grsHash=e.grsHash.reverse();var s=e.grsHash.pop();e.grsEnter(!1,!1,s.id,s.type)}}}},e.CheckGrsHashForPopup=function(){for(var t=e.grsHash.pop(),a=!1,i=0;i<e.pageination.pagedItems[0].length;i++)if(e.pageination.pagedItems[0][i].id==t.id){a=!0;break}a?e.clickAction(i):e.clickAction("hash-"+t.id)},e.grsEnter=function(i,n,o,r){n&&n.preventDefault();var s=e.mainPageination,g=e.pageination,c=s.album,l=s.currentPage,m=s.pagesCount,p=s.totalcount,u=r?"gallery"==r?"gal":"alb":s.pagedItems[s.currentPage][i].contentType,o=o||s.pagedItems[l][i].contentId;if(e.options.eStack.push({albId:c,cP:l,pC:m,tC:p}),s.loading=!0,e.params.loadedCount=0,"gal"===u)g.scrolling=!1,g.loadedCount=0,g.totalcount=-1,g.pagesCount=0,t.getGalleryData(0,g.itemsPerPage,o,1,e.params.shatts.galorderby,e.params.shatts.galordering,e.params.shatts.theme,e.params.shatts.galview).then(function(t){g.gallExists=t.data.gallExists,s.loading=!1,e.options.back=!0,e.options.albumView=!1,e.params.albumView=!1,g.gallery=o,e.params.data.theme[e.params.shatts.galview.toLowerCase()]=JSON.parse(t.data.theme[e.params.shatts.galview.toLowerCase()]),e.params.data.theme.lightbox=JSON.parse(t.data.theme.lightbox),g.pagedItems=[],g.currentPage=0,g.pagedItems[0]=t.data.images,g.totalcount=t.data.count,g.pagesCount=Math.ceil(g.totalcount/g.itemsPerPage),g.loadedCount=g.pagesCount>0?1:0,g.positioning(),e.grsHash.length?e.CheckGrsHashForPopup():e.setLh()},function(e){a.log(e)});else{if("alb"!==u)return void a.log("Something went wrong.");s.scrolling=!1,s.loadedCount=0,s.totalcount=-1,s.pagesCount=0,t.getAlbumData(0,s.itemsPerPage,o,1,e.params.shatts.orderby,e.params.shatts.ordering,e.params.shatts.theme,e.params.shatts.mainview).then(function(t){if(s.albExists=t.data.albExists,s.loading=!1,e.options.back=!0,s.album=o,e.params.data.theme[e.params.shatts.mainview.toLowerCase()]=JSON.parse(t.data.theme[e.params.shatts.mainview.toLowerCase()]),e.params.data.theme.lightbox=JSON.parse(t.data.theme.lightbox),s.pagedItems=[],s.currentPage=0,s.pagedItems[0]=t.data.content,s.totalcount=t.data.count,s.pagesCount=Math.ceil(s.totalcount/s.itemsPerPage),s.loadedCount=s.pagesCount>0?1:0,a.log("mtanq album "+s.loadedCount),s.positioning(),e.grsHash.length){var i=e.grsHash.pop();e.grsEnter(!1,!1,i.id,i.type)}else e.setLh()},function(e){a.log(e)})}e.scrollTop()},e.grsBack=function(i){i.preventDefault();var n=e.options.eStack.pop();if(!angular.isUndefined(n)){var o=e.options.albumView,r=o?e.mainPageination:e.pageination;o?r.album:r.gallery;r.loading=!0,e.mainPageination.album=n.albId,e.mainPageination.scrolling=!1,e.mainPageination.loadedCount=0,e.mainPageination.totalcount=-1,e.mainPageination.pagesCount=0,e.params.loadedCount=0,t.getAlbumData(n.cP,e.mainPageination.itemsPerPage,n.albId,0,e.params.shatts.orderby,e.params.shatts.ordering).then(function(t){e.mainPageination.albExists=t.data.albExists,r.loading=!1,0==e.options.eStack.length&&(e.options.back=!1),e.options.albumView=!0,e.params.albumView=!0,e.params.data.theme=e.options.albThRes,e.mainPageination.pagedItems=[],e.mainPageination.pagedItems[n.cP]=t.data.content,e.mainPageination.currentPage=n.cP,e.mainPageination.totalcount=n.tC,e.mainPageination.pagesCount=n.pC,e.mainPageination.loadedCount=e.mainPageination.pagesCount>0?1:0,e.mainPageination.positioning(),e.scrollTop(),e.setLh()},function(e){a.log(e)})}},e.getImageSrc=function(t){var i=e.options.albumView,n=i?"mainPageination":"pageination",o=i?e.params.shatts.mainview.toLowerCase():e.params.shatts.galview.toLowerCase(),r=e[n].pagedItems[e[n].currentPage][t];return"grsnopv"===r.name&&""===r.path?a.imagesDir+r.name+r.type:i?a.uploaderUrl+r.path+a.getImageVer(r.thumbWidth,r.thumbHeight,o)+r.name+r.type:a.getImageSource(r,o)},e.$watch(function(){return a.settingsReady},function(i,n){i&&t.getAlbumData(0,e.mainPageination.itemsPerPage,e.params.shatts.id,1,e.params.shatts.orderby,e.params.shatts.ordering,e.params.shatts.theme,e.params.shatts.mainview).then(function(t){e.mainPageination.albExists=t.data.albExists,e.mainPageination.loading=!1,e.params.data.theme[e.params.shatts.mainview.toLowerCase()]=JSON.parse(t.data.theme[e.params.shatts.mainview.toLowerCase()]),e.params.data.theme.lightbox=JSON.parse(t.data.theme.lightbox),e.options.albThRes=e.params.data.theme,e.mainPageination.album=e.params.shatts.id,e.mainPageination.pagedItems[0]=t.data.content,e.mainPageination.totalcount=t.data.count,e.mainPageination.pagesCount=Math.ceil(e.mainPageination.totalcount/e.mainPageination.itemsPerPage),e.mainPageination.loadedCount=e.mainPageination.pagesCount>0?1:0,e.mainPageination.albExists&&(e.mainPageination.positioning(),e.CheckGrsHash())},function(e){a.log(e)})},!0)}}}]),grsApp.directive("grsNav",["$filter","$compile","$parse","GrsFactory","GrsService",function(e,t,a,i,n){return{restrict:"E",transclude:!0,scope:{pageInation:"="},template:'<div ng-include="options.grsNavView" class="grsNavInc"></div>',link:function(t,a,o){t.options={showNav:!1},t.$watch("pageInation.navView",function(){t.options.grsNavView="scrolling"!=t.pageInation.navView?n.getViewsTemplateUrl("grsPagenav"+t.pageInation.navView):""},!0),t.$watch("pageInation.totalcount",function(){var e=0==t.pageInation.totalcount,a=t.pageInation.forGallery?"There is no images in this gallery":"Album is empty",a=t.pageInation.forGallery&&!t.pageInation.gallExists?"There is no gallery matching your id or it was deleted":a,a=t.pageInation.forGallery||t.pageInation.albExists?a:"There is no album matching your id or it was deleted";t.pageInation.message(e,a,"error")},!0),t.$watch("pageInation.scrolling",function(){n.log("ekanq scrollingi watcher grsNavum"),n.log("watcher-i arjeq@ "+t.pageInation.scrolling),t.pageInation.scrolling&&(n.log("ekanq scrolling loadmore"),t.loadMore())},!0);var r=function(e,t){return!t||-1!==e.toLowerCase().indexOf(t.toLowerCase())};t.$watch("pageInation.pagesCount",function(){void 0!==t.pageInation.pagedItems&&void 0!==t.pageInation.pagesCount&&t.showNavF()}),t.search=function(){t.pageInation.filteredItems=e("filter")(t.pageInation.items,function(e){for(var a in e)if(r(e[a],t.query))return!0;return!1}),t.pageInation.currentPage=0,t.groupToPages()},t.groupToPages=function(){t.pageInation.pagedItems=[];for(var e=0;e<t.pageInation.filteredItems.length;e++)e%t.pageInation.itemsPerPage==0?t.pageInation.pagedItems[Math.floor(e/t.pageInation.itemsPerPage)]=[t.pageInation.filteredItems[e]]:t.pageInation.pagedItems[Math.floor(e/t.pageInation.itemsPerPage)].push(t.pageInation.filteredItems[e])},t.range=function(e,t){var a=[];t||(t=e,e=0);for(var i=e;i<t;i++)a.push(i);return a},t.getForGallery=function(e){t.pageInation.loading=!0,i.getGalleryData(e,t.pageInation.itemsPerPage,t.pageInation.gallery,0,t.pageInation.orderBy,t.pageInation.ordering).then(function(a){t.pageInation.loading=!1,t.pageInation.pagedItems[e]=a.data.images,t.pageInation.currentPage=e,t.pageInation.positioning()},function(e){n.log(e)})},t.getForAlbum=function(e){t.pageInation.loading=!0,i.getAlbumData(e,t.pageInation.itemsPerPage,t.pageInation.album,0,t.pageInation.orderBy,t.pageInation.ordering).then(function(a){t.pageInation.loading=!1,t.pageInation.pagedItems[e]=a.data.content,t.pageInation.currentPage=e,t.pageInation.positioning()},function(e){n.log(e)})},t.checkPage=function(e){void 0===t.pageInation.pagedItems[e]?void 0!==t.pageInation.forGallery&&t.pageInation.forGallery?t.getForGallery(e):void 0===t.pageInation.forGallery||t.pageInation.forGallery?n.log("Something went wrong."):t.getForAlbum(e):(t.pageInation.currentPage=e,t.pageInation.positioning()),jQuery("html, body").animate({scrollTop:jQuery("#grsGal"+t.pageInation.grs).offset().top-100},500)},t.prevPage=function(){if(t.pageInation.currentPage>0){var e=t.pageInation.currentPage;t.checkPage(--e)}},t.loadMore=function(e){void 0!==e&&e.preventDefault(),t.pageInation.loading?n.log("Loading in progress"):t.pageInation.loadedCount!=t.pageInation.pagesCount&&0!=t.pageInation.pagesCount?angular.isUndefined(t.pageInation.pagedItems[0])?n.log("Problem with first load"):void 0!==t.pageInation.forGallery&&t.pageInation.forGallery?(t.pageInation.loading=!0,t.pageInation.scrolling=!1,i.getGalleryData(t.pageInation.loadedCount,t.pageInation.itemsPerPage,t.pageInation.gallery,0,t.pageInation.orderBy,t.pageInation.ordering).then(function(e){t.pageInation.loading=!1,t.pageInation.loadedCount+=1,t.pageInation.pagedItems[0]=t.pageInation.pagedItems[0].concat(e.data.images),t.pageInation.positioning(),t.showNavF()},function(e){n.log(e)})):void 0===t.pageInation.forGallery||t.pageInation.forGallery||(t.pageInation.loading=!0,t.pageInation.scrolling=!1,i.getAlbumData(t.pageInation.loadedCount,t.pageInation.itemsPerPage,t.pageInation.album,0,t.pageInation.orderBy,t.pageInation.ordering).then(function(e){t.pageInation.loading=!1,t.pageInation.loadedCount+=1,t.pageInation.pagedItems[0]=t.pageInation.pagedItems[0].concat(e.data.content),t.pageInation.positioning(),t.showNavF()},function(e){n.log(e)})):n.log("Already all is loaded")},t.nextPage=function(){if(t.pageInation.currentPage<t.pageInation.pagesCount-1){var e=t.pageInation.currentPage;t.checkPage(++e)}},t.lastPage=function(){if(t.pageInation.currentPage<t.pageInation.pagesCount-1){var e=t.pageInation.pagesCount-1;t.checkPage(e)}},t.firstPage=function(){if(t.pageInation.currentPage>0){t.checkPage(0)}},t.setPage=function(){var e=this.n;t.checkPage(e)},t.showNavF=function(){n.log("loaded count - "+t.pageInation.loadedCount),n.log("pagesCount count - "+t.pageInation.pagesCount),"numbers"!=t.pageInation.navView?t.options.showNav=t.pageInation.loadedCount!=t.pageInation.pagesCount&&0!=t.pageInation.pagesCount:t.options.showNav=1!=t.pageInation.pagesCount&&0!=t.pageInation.pagesCount}}}}]),grsApp.factory("GrsFactory",["$http","$q","GrsService",function(e,t,a){return{getGalleryData:function(i,n,o,r,s,g,c,l){var m={action:"grsGalleryAjax",grsAction:"getGalleryData",id:o,start:i,count:n,orderBy:s,ordering:g,firstRequest:r,theme:r?c:0,view:r?l:""};return e({method:"POST",url:grsAjaxUrl,data:jQuery.param(m),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,a,i,n){return t.reject(e)}).error(function(e,t){a.log("errr"),401==t&&a.log(e)})},getAlbumData:function(i,n,o,r,s,g,c,l){var m={action:"grsGalleryAjax",grsAction:"getAlbumData",id:o,start:i,count:n,orderBy:s,ordering:g,firstRequest:r,theme:r?c:0,view:r?l:""};return e({method:"POST",url:grsAjaxUrl,data:jQuery.param(m),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,a,i,n){return t.reject(e)}).error(function(e,t){a.log("errr"),401==t&&a.log(e)})},getPopupData:function(i,n,o,r,s){var g={action:"grsGalleryAjax",grsAction:"getPopupData",id:i,offsets:n,perPage:o,orderBy:r,ordering:s};return e({method:"POST",url:grsAjaxUrl,data:jQuery.param(g),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,a,i,n){return t.reject(e)}).error(function(e,t){a.log("errr"),401==t&&a.log(e)})},getSettings:function(){var i={action:"grsGalleryAjax",grsAction:"getSettingsForF"};return e({method:"POST",url:grsAjaxUrl,data:jQuery.param(i),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,a,i,n){return t.reject(e)}).error(function(e,t){a.log("errr"),401==t&&a.log(e)})},getEffects:function(){return e.get(a.effectsJsonUrl).success(function(e){return t.reject(e.data)})},getImgComm:function(i,n){var o={action:"grsGalleryAjax",grsAction:"showComments",id:i,gallId:n};return e({method:"POST",url:grsAjaxUrl,data:jQuery.param(o),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,a,i,n){return t.reject(e)}).error(function(e,t){a.log("errr"),401==t&&a.log(e)})},postIc:function(i,n,o,r,s,g){var c={action:"grsGalleryAjax",grsAction:"comment",name:i,captchaCode:n,email:o,comment:r,imageId:s,galId:g};return e({method:"POST",url:grsAjaxUrl,data:jQuery.param(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,i,n,o){return a.log(e),t.reject(e)}).error(function(e,t){a.log("errr"),401==t&&a.log(e)})},reloadCap:function(i,n,o){var r={action:"grsGalleryAjax",grsAction:"reloadCaptcha"};return e({method:"POST",url:grsAjaxUrl,data:jQuery.param(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,a,i,n){return t.reject(e)}).error(function(e,t){a.log("errr"),401==t&&a.log(e)})},ThumbnailPositioning:function(e,t,a){var i=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),n=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),o=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),r=n==o,s=0,g=e.data.theme.thumbnail,c=parseInt(g.thumbnailmargin),l="none"!=g.thumbnailBorderStyle?2*parseInt(g.thumbnailBorderWidth):0,m=[],p=[];l+=2*parseInt(g.thumbnailpadding);var u=Math.round(parseInt(i+c)/(n+l+c));if(u=t.pagedItems[t.currentPage].length<u?t.pagedItems[t.currentPage].length:u,n=(i+c-u*(l+c))/u,0!=u){for(C=0;C<u;C++)p[C]=[],m[C]=0;o=r?n:o;for(w=0;w<t.pagedItems[t.currentPage].length;w++){t.pagedItems[t.currentPage][w].thumbHeight=o,t.pagedItems[t.currentPage][w].thumbWidth=n;var h=Math.min.apply(Math,m),d=m.indexOf(h);m[d]+=o+l+c,p[d].push(t.pagedItems[t.currentPage][w])}var f=Math.max.apply(Math,m),v=0;s+=m[m.indexOf(f)]-c;for(var w=0;w<p.length;w++){for(var I=0,C=0;C<p[w].length;C++)p[w][C].left=v,p[w][C].top=I,I+=p[w][C].thumbHeight+l+c;v+=n+l+c}i=v-c,e.contWidth=i,e.contHeight=s}else e.contHeight=50},FilmPositioning:function(e,t,a){var i=jQuery("#grsGal"+e.grs).parent().width(),n=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth),o=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),r=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),s=e.data.theme.film,g=parseInt(s.fmThumbMargin),c=parseInt(s.fmMargin),l="none"!==s.fmThumbBorderStyle?parseInt(s.fmThumbBorderWidth):0,m=parseInt(s.fmThumbPadding);e.contWidth=i*(n/100),e.thumbWidth=o,e.thumbHeight=r,e.contHeight=r+2*(c+m+l),e.flHeight=r+2*(m+l),e.flWidth=t.pagedItems[t.currentPage].length*(o+g+2*(m+l))+g,a&&a("left")},MasonryVerPositioning:function(e,t,a){var i=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),n=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),o=0,r=e.data.theme.masonry,s=parseInt(r.masonrymargin),g="none"!=r.masonryBorderStyle?2*parseInt(r.masonryBorderWidth):0,c=[],l=[];g+=2*parseInt(r.masonryPadding);var m=Math.round(parseInt(i+s)/(n+g+s));if(m=t.pagedItems[t.currentPage].length<m?t.pagedItems[t.currentPage].length:m,n=(i+s-m*(g+s))/m,0!=m){for(I=0;I<m;I++)l[I]=[],c[I]=0;for(v=0;v<t.pagedItems[t.currentPage].length;v++){var p=n*parseInt(t.pagedItems[t.currentPage][v].height)/parseInt(t.pagedItems[t.currentPage][v].width);t.pagedItems[t.currentPage][v].thumbHeight=p,t.pagedItems[t.currentPage][v].thumbWidth=n;var u=Math.min.apply(Math,c),h=c.indexOf(u);c[h]+=p+g+s,l[h].push(t.pagedItems[t.currentPage][v])}var d=Math.max.apply(Math,c);o+=c[c.indexOf(d)]-s;for(var f=0,v=0;v<l.length;v++){for(var w=0,I=0;I<l[v].length;I++)l[v][I].left=f,l[v][I].top=w,w+=l[v][I].thumbHeight+g+s;f+=n+g+s}i=f-s,e.contWidth=i,e.contHeight=o}else e.contHeight=50},MasonryHorPositioning:function(e,t,a){var i=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),n=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),o=0,r=e.data.theme.masonry,s=parseInt(r.masonrymargin),g="none"!=r.masonryBorderStyle?2*parseInt(r.masonryBorderWidth):0,c=[];g+=2*parseInt(r.masonryPadding);for(var l=0,m=0,p=[],u=0;u<t.pagedItems[t.currentPage].length;u++){var h=parseInt(t.pagedItems[t.currentPage][u].height),d=n*(parseInt(t.pagedItems[t.currentPage][u].width)/h);t.pagedItems[t.currentPage][u].thumbHeight=n,t.pagedItems[t.currentPage][u].thumbWidth=d,(l+=d+(0==u?g:s+g))/i>1?(0!=u&&c.push(p),(p=[]).push(t.pagedItems[t.currentPage][u]),l=d+g):p.push(t.pagedItems[t.currentPage][u])}if(c.push(p),0!=c.length){for(var f=0,u=0;u<c.length;u++){for(var v=0,m=0;m<c[u].length;m++)c[u][m].left=v,c[u][m].top=f,v+=c[u][m].thumbWidth+s+g;f+=n+s+g}o=f,e.contWidth=i,e.contHeight=o}else e.contHeight=50},MosaicVerPositioning:function(e,t,a){var i=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),n=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),o=0,r=e.data.theme.mosaic,s=parseInt(r.mosaicMargin),g="none"!=r.mosaicBorderStyle?2*parseInt(r.mosaicBorderWidth):0,c=[],l=[],m=[],p=[],u=1,h=0;g+=2*parseInt(r.mosaicPadding);var d=Math.round(parseInt(i+s)/(n+g+s));if(0!=(d=t.pagedItems[t.currentPage].length<d?t.pagedItems[t.currentPage].length:d)){for(A=0;A<d;A++)c[A]=[],l[A]=0;for(C=0;C<t.pagedItems[t.currentPage].length;C++){k=n*(S=parseInt(t.pagedItems[t.currentPage][C].height))/(x=parseInt(t.pagedItems[t.currentPage][C].width));t.pagedItems[t.currentPage][C].thumbHeight=k,t.pagedItems[t.currentPage][C].thumbWidth=n;var f=Math.min.apply(Math,l),v=l.indexOf(f);l[v]+=k+g+s,c[v].push(t.pagedItems[t.currentPage][C])}for(C=0;C<c.length;C++){p[C]=0;for(A=0;A<c[C].length;A++)p[C]+=c[C][A].thumbHeight/c[C][A].thumbWidth}for(var w=c[0].length,I=c.length,C=1;C<c.length;C++){b=c[C].length;u+=p[0]/p[C],h+=(w*g+(w-1)*s-(b*g+(b-1)*s))/p[C]}m[0]=(i-(I*g+(I-1)*s)-h)/u;for(C=1;C<p.length;C++){var b=c[C].length;m[C]=(m[0]*p[0]+w*g+(w-1)*s-(b*g+(b-1)*s))/p[C]}for(var y=0,C=0;C<c.length;C++){for(var P=0,A=0;A<c[C].length;A++){var S=parseInt(c[C][A].height),x=parseInt(c[C][A].width),k=m[C]*S/x;c[C][A].thumbWidth=m[C],c[C][A].thumbHeight=k,c[C][A].left=y,c[C][A].top=P,P+=k+g+s}y+=m[C]+g+s}o=P-s,e.contWidth=i,e.contHeight=o}else e.contHeight=50},MosaicHorPositioning:function(e,t,a){var i,n=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),o=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),r=0,s=0,g=e.data.theme.mosaic,c=parseInt(g.mosaicMargin),l="none"!=g.mosaicBorderStyle?2*parseInt(g.mosaicBorderWidth):0,m=2*parseInt(g.mosaicPadding),p=(parseInt(e.shatts.contwidth),[]),u=[];l+=m;for(var h=0,d=0,f=[],v=0;v<t.pagedItems[t.currentPage].length;v++){var w=parseInt(t.pagedItems[t.currentPage][v].height),I=o*(parseInt(t.pagedItems[t.currentPage][v].width)/w);t.pagedItems[t.currentPage][v].thumbHeight=o,t.pagedItems[t.currentPage][v].thumbWidth=I,(h+=I+(0==v?l:c+l))/n>1&&v!=t.pagedItems[t.currentPage].length-1?(0!=v&&p.push(f),(f=[]).push(t.pagedItems[t.currentPage][v]),h=I+l):f.push(t.pagedItems[t.currentPage][v])}if(p.push(f),0!=(s=p.length)){if(s>1){if(i=p[s-1],nearLast=p[s-2],nearLast.length/i.length>=2)for(;0!=p[s-1].length;)p[s-2].push(p[s-1].pop());0==p[s-1].length&&p.pop()}for(v=0;v<p.length;v++){for(var C=0,d=0;d<p[v].length;d++)C+=p[v][d].thumbWidth/p[v][d].thumbHeight;u.push((n-((d-1)*c+d*l))/C)}for(var b=0,v=0;v<p.length;v++){for(var y=0,d=0;d<p[v].length;d++){var P=u[v]*(p[v][d].width/p[v][d].height);p[v][d].thumbWidth=P,p[v][d].thumbHeight=u[v],p[v][d].left=y,p[v][d].top=b,y+=P+c+l}b+=u[v]+c+l}r=b,e.contWidth=n,e.contHeight=r}else e.contHeight=50}}}]);